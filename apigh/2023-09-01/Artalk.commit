{
  "sha": "5eddd9ff0511d7c16ea80c2295898d49b6ff3335",
  "node_id": "C_kwDOCQOkhNoAKDVlZGRkOWZmMDUxMWQ3YzE2ZWE4MGMyMjk1ODk4ZDQ5YjZmZjMzMzU",
  "commit": {
    "author": {
      "name": "qwqcode",
      "email": "22412567+qwqcode@users.noreply.github.com",
      "date": "2023-09-01T11:34:57Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2023-09-01T11:34:57Z"
    },
    "message": "feat(config): support load env variables as config (#564)",
    "tree": {
      "sha": "92d428af5aa5cbbdbe576fe52ba76dd6175fe5eb",
      "url": "https://api.github.com/repos/ArtalkJS/Artalk/git/trees/92d428af5aa5cbbdbe576fe52ba76dd6175fe5eb"
    },
    "url": "https://api.github.com/repos/ArtalkJS/Artalk/git/commits/5eddd9ff0511d7c16ea80c2295898d49b6ff3335",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJk8cxhCRBK7hj4Ov3rIwAAH+kIAEvm+7VNTZ6vok0pV6tyhMU5\nI17/E+SlBRR4ahueWnjHAaoWgNvB75wAOk2kL0QCh6liHXhx01tx3Ew4hhlYIlMM\nAaaIC4+S1dDMJBvEWilO4KWrzUotHXikJWC88zQolj50a0eq1A3kn/g93TN4YAnL\nPN/6HuAXVkfTTAxZtlxCwEhxGjQQ5mx5aw2gKOzd22kAsC8wI8I6SBf3D24wu6Bs\nQUd/N6Y21xuLfaBrXzdE2TALgPjlZOtW58cS/ejiALQysgwk5dau3canER+SNBhG\n2cpagbvzsTSDoVYykpYKSVm8KAMrZYE5B6rHahwxIuI4JcCTcwo/+Z8RCHxIqkI=\n=zpgU\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 92d428af5aa5cbbdbe576fe52ba76dd6175fe5eb\nparent 9fdfb2a043aecb5d6b4aac838af3d8b5ba3e35de\nauthor qwqcode <22412567+qwqcode@users.noreply.github.com> 1693568097 +0800\ncommitter GitHub <noreply@github.com> 1693568097 +0800\n\nfeat(config): support load env variables as config (#564)\n\n"
    }
  },
  "url": "https://api.github.com/repos/ArtalkJS/Artalk/commits/5eddd9ff0511d7c16ea80c2295898d49b6ff3335",
  "html_url": "https://github.com/ArtalkJS/Artalk/commit/5eddd9ff0511d7c16ea80c2295898d49b6ff3335",
  "comments_url": "https://api.github.com/repos/ArtalkJS/Artalk/commits/5eddd9ff0511d7c16ea80c2295898d49b6ff3335/comments",
  "author": {
    "login": "qwqcode",
    "id": 22412567,
    "node_id": "MDQ6VXNlcjIyNDEyNTY3",
    "avatar_url": "https://avatars.githubusercontent.com/u/22412567?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/qwqcode",
    "html_url": "https://github.com/qwqcode",
    "followers_url": "https://api.github.com/users/qwqcode/followers",
    "following_url": "https://api.github.com/users/qwqcode/following{/other_user}",
    "gists_url": "https://api.github.com/users/qwqcode/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/qwqcode/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/qwqcode/subscriptions",
    "organizations_url": "https://api.github.com/users/qwqcode/orgs",
    "repos_url": "https://api.github.com/users/qwqcode/repos",
    "events_url": "https://api.github.com/users/qwqcode/events{/privacy}",
    "received_events_url": "https://api.github.com/users/qwqcode/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9fdfb2a043aecb5d6b4aac838af3d8b5ba3e35de",
      "url": "https://api.github.com/repos/ArtalkJS/Artalk/commits/9fdfb2a043aecb5d6b4aac838af3d8b5ba3e35de",
      "html_url": "https://github.com/ArtalkJS/Artalk/commit/9fdfb2a043aecb5d6b4aac838af3d8b5ba3e35de"
    }
  ],
  "stats": {
    "total": 13,
    "additions": 13,
    "deletions": 0
  },
  "files": [
    {
      "sha": "53199b3bd327c1e40f01ccb6c97f24a8efca5c9f",
      "filename": "internal/config/base.go",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/5eddd9ff0511d7c16ea80c2295898d49b6ff3335/internal%2Fconfig%2Fbase.go",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/5eddd9ff0511d7c16ea80c2295898d49b6ff3335/internal%2Fconfig%2Fbase.go",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/internal%2Fconfig%2Fbase.go?ref=5eddd9ff0511d7c16ea80c2295898d49b6ff3335",
      "patch": "@@ -11,6 +11,7 @@ import (\n \t\"github.com/ArtalkJS/Artalk/internal/utils\"\n \t\"github.com/knadh/koanf\"\n \t\"github.com/knadh/koanf/parsers/yaml\"\n+\t\"github.com/knadh/koanf/providers/env\"\n \t\"github.com/knadh/koanf/providers/file\"\n )\n \n@@ -29,6 +30,18 @@ func NewFromFile(cfgFile string) (*Config, error) {\n \t\treturn nil, fmt.Errorf(\"config file read error: %w\", err)\n \t}\n \n+\t// load environment variables and merge into the loaded config\n+\tconst envPrefix = \"ATK_\"\n+\tif err := kf.Load(env.Provider(envPrefix, \".\", func(s string) string {\n+\t\t// FOO__BAR -> foo_bar to handle dash in config names\n+\t\ts = strings.ToLower(strings.TrimPrefix(s, envPrefix))\n+\t\ts = strings.ReplaceAll(s, \"__\", \"-\")\n+\t\ts = strings.ReplaceAll(s, \"_\", \".\")\n+\t\treturn strings.ReplaceAll(s, \"-\", \"_\")\n+\t}), nil); err != nil {\n+\t\treturn nil, fmt.Errorf(\"config environment variable parse error: %w\", err)\n+\t}\n+\n \t// create new config instance\n \tconf := &Config{\n \t\tcfgFile: cfgFile,"
    }
  ]
}
