{
  "sha": "90042e7223521782f61f15388d4e61da9f6df8e1",
  "node_id": "C_kwDOAF-mA9oAKDkwMDQyZTcyMjM1MjE3ODJmNjFmMTUzODhkNGU2MWRhOWY2ZGY4ZTE",
  "commit": {
    "author": {
      "name": "ix5",
      "email": "ix5@users.noreply.github.com",
      "date": "2022-05-07T23:10:32Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2022-05-07T23:10:32Z"
    },
    "message": "Merge pull request #868 from ix5/js-unit-tests\n\n[js] [tests] Add unit tests for postbox, comment-loader, comment rendering; better stubbing/TZ handling",
    "tree": {
      "sha": "ed6ed018b024737acae109c8cea3c775c09b9270",
      "url": "https://api.github.com/repos/posativ/isso/git/trees/ed6ed018b024737acae109c8cea3c775c09b9270"
    },
    "url": "https://api.github.com/repos/posativ/isso/git/commits/90042e7223521782f61f15388d4e61da9f6df8e1",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJidvxoCRBK7hj4Ov3rIwAAkdIIAET+jODS2uLbs8U+xomrqSIp\n4LyaSysqYh6o8cBXOHTNVaN0Id643Gt/3sV/ZSYcHEwpozMnwbIzTBExPr/d/EE2\nT+idOBoTLqz1QmTgc/mtH/N5FlSS+KapGPsfIh283SCqxXRjLj24/hR4NBfWCwzf\nMI9KrLLerkppQU0JlY7ateQgXmW9dtuGwt6eYhTfOwEKFEnWy+ZzTOOaX7cWEu+K\nQ974ElDjQoYud12DiMJZUXB6v4QzP/4+cJWVyAaj7uG65Qdypy7PM2tLBIdSqiNk\nhVj0kKwC1OQ2B47xxMsRIOAHcJh6ZYnLaHrcEdLkNtMWImKy/aOlEO40yv+C7l0=\n=Sssc\n-----END PGP SIGNATURE-----\n",
      "payload": "tree ed6ed018b024737acae109c8cea3c775c09b9270\nparent 0c8673561e2f8de129c5d82fba7e22de7d1a4043\nparent 46cffed4f09c2aedfaa81f3ed73685f624b4c303\nauthor ix5 <ix5@users.noreply.github.com> 1651965032 +0200\ncommitter GitHub <noreply@github.com> 1651965032 +0200\n\nMerge pull request #868 from ix5/js-unit-tests\n\n[js] [tests] Add unit tests for postbox, comment-loader, comment rendering; better stubbing/TZ handling"
    }
  },
  "url": "https://api.github.com/repos/posativ/isso/commits/90042e7223521782f61f15388d4e61da9f6df8e1",
  "html_url": "https://github.com/posativ/isso/commit/90042e7223521782f61f15388d4e61da9f6df8e1",
  "comments_url": "https://api.github.com/repos/posativ/isso/commits/90042e7223521782f61f15388d4e61da9f6df8e1/comments",
  "author": {
    "login": "ix5",
    "id": 10212877,
    "node_id": "MDQ6VXNlcjEwMjEyODc3",
    "avatar_url": "https://avatars.githubusercontent.com/u/10212877?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ix5",
    "html_url": "https://github.com/ix5",
    "followers_url": "https://api.github.com/users/ix5/followers",
    "following_url": "https://api.github.com/users/ix5/following{/other_user}",
    "gists_url": "https://api.github.com/users/ix5/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ix5/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ix5/subscriptions",
    "organizations_url": "https://api.github.com/users/ix5/orgs",
    "repos_url": "https://api.github.com/users/ix5/repos",
    "events_url": "https://api.github.com/users/ix5/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ix5/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0c8673561e2f8de129c5d82fba7e22de7d1a4043",
      "url": "https://api.github.com/repos/posativ/isso/commits/0c8673561e2f8de129c5d82fba7e22de7d1a4043",
      "html_url": "https://github.com/posativ/isso/commit/0c8673561e2f8de129c5d82fba7e22de7d1a4043"
    },
    {
      "sha": "46cffed4f09c2aedfaa81f3ed73685f624b4c303",
      "url": "https://api.github.com/repos/posativ/isso/commits/46cffed4f09c2aedfaa81f3ed73685f624b4c303",
      "html_url": "https://github.com/posativ/isso/commit/46cffed4f09c2aedfaa81f3ed73685f624b4c303"
    }
  ],
  "stats": {
    "total": 242,
    "additions": 225,
    "deletions": 17
  },
  "files": [
    {
      "sha": "d8bdc57ff50d1bd51c46a5409db2c4ec670c9ce4",
      "filename": "isso/js/app/isso.js",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/posativ/isso/blob/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Fapp%2Fisso.js",
      "raw_url": "https://github.com/posativ/isso/raw/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Fapp%2Fisso.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Fapp%2Fisso.js?ref=90042e7223521782f61f15388d4e61da9f6df8e1",
      "patch": "@@ -416,6 +416,7 @@ var insert = function(comment, scrollIntoView) {\n };\n \n module.exports = {\n+    editorify: editorify,\n     insert: insert,\n     insert_loader: insert_loader,\n     Postbox: Postbox,"
    },
    {
      "sha": "1c3e26690fbf689d7300266c151388dd8d3cef1d",
      "filename": "isso/js/jest-unit.config.js",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/posativ/isso/blob/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Fjest-unit.config.js",
      "raw_url": "https://github.com/posativ/isso/raw/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Fjest-unit.config.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Fjest-unit.config.js?ref=90042e7223521782f61f15388d4e61da9f6df8e1",
      "patch": "@@ -30,14 +30,16 @@ const config = {\n   modulePaths: [\"<rootDir>\"],\n   /* rootDir already set to pwd when running jest with this config as arg */\n   moduleNameMapper: {\n-    \"\\.svg$\": \"<rootDir>/tests/mocks/fileMock.js\",\n+    \"\\.svg$\": \"<rootDir>/tests/mocks/fileTransformer.js\",\n   },\n \n   /* Run tests in a virtual DOM environment\n    * See https://jestjs.io/docs/tutorial-jquery\n    * -> use per-file testEnvironment stanza instead\n    */\n   //testEnvironment: \"jsdom\",\n+\n+  \"globalSetup\": \"<rootDir>/tests/setup/global-setup.js\"\n };\n \n module.exports = config;"
    },
    {
      "sha": "86059f36292497436f0fdbd0fb673f6ea9535159",
      "filename": "isso/js/tests/mocks/fileMock.js",
      "status": "removed",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/posativ/isso/blob/0c8673561e2f8de129c5d82fba7e22de7d1a4043/isso%2Fjs%2Ftests%2Fmocks%2FfileMock.js",
      "raw_url": "https://github.com/posativ/isso/raw/0c8673561e2f8de129c5d82fba7e22de7d1a4043/isso%2Fjs%2Ftests%2Fmocks%2FfileMock.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Fmocks%2FfileMock.js?ref=0c8673561e2f8de129c5d82fba7e22de7d1a4043",
      "patch": "@@ -1 +0,0 @@\n-module.exports = 'test-file-stub';"
    },
    {
      "sha": "d0580e878ab79fe0c6d62ca74953b7da09530c20",
      "filename": "isso/js/tests/mocks/fileTransformer.js",
      "status": "added",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/posativ/isso/blob/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Fmocks%2FfileTransformer.js",
      "raw_url": "https://github.com/posativ/isso/raw/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Fmocks%2FfileTransformer.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Fmocks%2FfileTransformer.js?ref=90042e7223521782f61f15388d4e61da9f6df8e1",
      "patch": "@@ -0,0 +1,11 @@\n+// https://jestjs.io/docs/next/code-transformation#transforming-images-to-their-path\n+\n+const path = require('path');\n+\n+module.exports = {\n+  process(sourceText, sourcePath, options) {\n+    return {\n+      code: `module.exports = ${JSON.stringify(path.basename(sourcePath))};`,\n+    };\n+  },\n+};"
    },
    {
      "sha": "46ebfa240747d404d4f1d23d31da925f315ab94d",
      "filename": "isso/js/tests/setup/global-setup.js",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/posativ/isso/blob/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Fsetup%2Fglobal-setup.js",
      "raw_url": "https://github.com/posativ/isso/raw/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Fsetup%2Fglobal-setup.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Fsetup%2Fglobal-setup.js?ref=90042e7223521782f61f15388d4e61da9f6df8e1",
      "patch": "@@ -0,0 +1,4 @@\n+// https://stackoverflow.com/questions/56261381/how-do-i-set-a-timezone-in-my-jest-config/56482581#56482581\n+module.exports = async () => {\n+    process.env.TZ = 'UTC';\n+};"
    },
    {
      "sha": "93f07dcaf7a1a9a3557049bf3041964bd7c6502e",
      "filename": "isso/js/tests/unit/__snapshots__/comment-loader.test.js.snap",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/posativ/isso/blob/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2F__snapshots__%2Fcomment-loader.test.js.snap",
      "raw_url": "https://github.com/posativ/isso/raw/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2F__snapshots__%2Fcomment-loader.test.js.snap",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Funit%2F__snapshots__%2Fcomment-loader.test.js.snap?ref=90042e7223521782f61f15388d4e61da9f6df8e1",
      "patch": "@@ -0,0 +1,3 @@\n+// Jest Snapshot v1, https://goo.gl/fbAQLP\n+\n+exports[`Create comment loader 1`] = `\"<div id=\\\\\"isso-root\\\\\"><div class=\\\\\"isso-comment-loader\\\\\" id=\\\\\"isso-loader-null\\\\\"><a class=\\\\\"isso-load-hidden\\\\\" href=\\\\\"#\\\\\">5 Hidden</a></div></div>\"`;"
    },
    {
      "sha": "81a1a766daebed4cb78aa8b88fe1fc9eeaed28d7",
      "filename": "isso/js/tests/unit/__snapshots__/comment.test.js.snap",
      "status": "added",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/posativ/isso/blob/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2F__snapshots__%2Fcomment.test.js.snap",
      "raw_url": "https://github.com/posativ/isso/raw/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2F__snapshots__%2Fcomment.test.js.snap",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Funit%2F__snapshots__%2Fcomment.test.js.snap?ref=90042e7223521782f61f15388d4e61da9f6df8e1",
      "patch": "@@ -0,0 +1,10 @@\n+// Jest Snapshot v1, https://goo.gl/fbAQLP\n+\n+exports[`Rendered comment should match snapshot 1`] = `\n+\"<div id=\\\\\"isso-root\\\\\"><div class=\\\\\"isso-comment isso-no-votes\\\\\" id=\\\\\"isso-2\\\\\" data-hash=\\\\\"4505c1eeda98\\\\\"><div class=\\\\\"isso-avatar\\\\\"><svg version=\\\\\"1.1\\\\\" viewBox=\\\\\"0 0 48 48\\\\\" preserveAspectRatio=\\\\\"xMinYMin meet\\\\\" shape-rendering=\\\\\"crispEdges\\\\\" data-hash=\\\\\"4505c1eeda98\\\\\"><rect x=\\\\\"0\\\\\" y=\\\\\"0\\\\\" width=\\\\\"56\\\\\" height=\\\\\"56\\\\\" style=\\\\\"fill: #f0f0f0\\\\\"></rect><rect x=\\\\\"4\\\\\" y=\\\\\"4\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"36\\\\\" y=\\\\\"4\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"4\\\\\" y=\\\\\"20\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"36\\\\\" y=\\\\\"20\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"4\\\\\" y=\\\\\"28\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"36\\\\\" y=\\\\\"28\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"12\\\\\" y=\\\\\"4\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"28\\\\\" y=\\\\\"4\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"12\\\\\" y=\\\\\"12\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"28\\\\\" y=\\\\\"12\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"12\\\\\" y=\\\\\"28\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"28\\\\\" y=\\\\\"28\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"20\\\\\" y=\\\\\"4\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"20\\\\\" y=\\\\\"28\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect><rect x=\\\\\"20\\\\\" y=\\\\\"36\\\\\" width=\\\\\"8\\\\\" height=\\\\\"8\\\\\" style=\\\\\"fill: #9abf88\\\\\"></rect></svg></div><div class=\\\\\"isso-text-wrapper\\\\\"><div class=\\\\\"isso-comment-header\\\\\" role=\\\\\"meta\\\\\"><a class=\\\\\"isso-author\\\\\" href=\\\\\"http://website.org\\\\\" rel=\\\\\"nofollow\\\\\">John</a><span class=\\\\\"isso-spacer\\\\\">â€¢</span><a class=\\\\\"isso-permalink\\\\\" href=\\\\\"#isso-2\\\\\"><time title=\\\\\"Thu May 05 2022 22:03:12 GMT+0000 (Coordinated Universal Time)\\\\\" datetime=\\\\\"2022-04-04T22:03:12Z\\\\\">right now</time></a><span class=\\\\\"isso-note\\\\\"></span></div><div class=\\\\\"isso-text\\\\\"><p>A comment with</p>\n+<pre><code>code blocks\n+New line: preformatted\n+\n+Double newline\n+</code></pre></div><div class=\\\\\"isso-comment-footer\\\\\"><span class=\\\\\"isso-votes\\\\\"></span><a class=\\\\\"isso-upvote\\\\\" href=\\\\\"#\\\\\">undefined</a><span class=\\\\\"isso-spacer\\\\\">|</span><a class=\\\\\"isso-downvote\\\\\" href=\\\\\"#\\\\\">undefined</a><a class=\\\\\"isso-reply\\\\\" href=\\\\\"#\\\\\">Reply</a></div></div><div class=\\\\\"isso-follow-up\\\\\"></div></div></div>\"\n+`;"
    },
    {
      "sha": "21ff1c64f3cd4ff719a5eaf8baed7cf7a6a88b43",
      "filename": "isso/js/tests/unit/__snapshots__/postbox.test.js.snap",
      "status": "renamed",
      "additions": 0,
      "deletions": 0,
      "changes": 0,
      "blob_url": "https://github.com/posativ/isso/blob/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2F__snapshots__%2Fpostbox.test.js.snap",
      "raw_url": "https://github.com/posativ/isso/raw/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2F__snapshots__%2Fpostbox.test.js.snap",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Funit%2F__snapshots__%2Fpostbox.test.js.snap?ref=90042e7223521782f61f15388d4e61da9f6df8e1",
      "previous_filename": "isso/js/tests/unit/__snapshots__/isso.test.js.snap"
    },
    {
      "sha": "2f45e2bc214ca589cf5d0eac3e819edf50cf0764",
      "filename": "isso/js/tests/unit/comment-loader.test.js",
      "status": "added",
      "additions": 46,
      "deletions": 0,
      "changes": 46,
      "blob_url": "https://github.com/posativ/isso/blob/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2Fcomment-loader.test.js",
      "raw_url": "https://github.com/posativ/isso/raw/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2Fcomment-loader.test.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Funit%2Fcomment-loader.test.js?ref=90042e7223521782f61f15388d4e61da9f6df8e1",
      "patch": "@@ -0,0 +1,46 @@\n+/**\n+ * @jest-environment jsdom\n+ */\n+\n+/* Keep the above exactly as-is!\n+ * https://jestjs.io/docs/configuration#testenvironment-string\n+ * https://jestjs.io/docs/configuration#testenvironmentoptions-object\n+ */\n+\n+\"use strict\";\n+\n+test('Create comment loader', () => {\n+  // Set up our document body\n+  document.body.innerHTML =\n+    '<div id=isso-thread></div>' +\n+    // Note: `src` and `data-isso` need to be set,\n+    // else `api` fails to initialize!\n+    // data-isso-id needed for insert_loader api.fetch()\n+    '<script src=\"http://isso.api/js/embed.min.js\"'\n+          + 'data-isso=\"/\"'\n+          + 'data-isso-id=\"1\"></script>';\n+\n+  const isso = require(\"app/isso\");\n+  const $ = require(\"app/dom\");\n+\n+  const config = require(\"app/config\");\n+  const i18n = require(\"app/i18n\");\n+  const svg = require(\"app/svg\");\n+\n+  const template = require(\"app/template\");\n+  template.set(\"pluralize\", i18n.pluralize);\n+\n+  let comment = {\n+    'id': null,\n+    'hidden_replies': 5,\n+  }\n+\n+  var isso_thread = $('#isso-thread');\n+  isso_thread.append('<div id=\"isso-root\"></div>');\n+\n+  isso.insert_loader(comment, null);\n+\n+  // Will create a `.snap` file in `./__snapshots__/`.\n+  // Don't forget to check in those files when changing anything!\n+  expect(isso_thread.innerHTML).toMatchSnapshot();\n+});"
    },
    {
      "sha": "2e8de7e799b965aee6f88f3fae3dbea8245abcc8",
      "filename": "isso/js/tests/unit/comment.test.js",
      "status": "added",
      "additions": 66,
      "deletions": 0,
      "changes": 66,
      "blob_url": "https://github.com/posativ/isso/blob/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2Fcomment.test.js",
      "raw_url": "https://github.com/posativ/isso/raw/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2Fcomment.test.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Funit%2Fcomment.test.js?ref=90042e7223521782f61f15388d4e61da9f6df8e1",
      "patch": "@@ -0,0 +1,66 @@\n+/**\n+ * @jest-environment jsdom\n+ */\n+\n+/* Keep the above exactly as-is!\n+ * https://jestjs.io/docs/configuration#testenvironment-string\n+ * https://jestjs.io/docs/configuration#testenvironmentoptions-object\n+ */\n+\n+\"use strict\";\n+\n+\n+test('Rendered comment should match snapshot', () => {\n+  // Set up our document body\n+  document.body.innerHTML =\n+    '<div id=isso-thread></div>' +\n+    // Note: `src` and `data-isso` need to be set,\n+    // else `api` fails to initialize!\n+    // data-isso-id needed for insert_loader api.fetch()\n+    '<script src=\"http://isso.api/js/embed.min.js\"'\n+          + 'data-isso=\"/\"'\n+          + 'data-isso-id=\"1\"></script>';\n+\n+  const isso = require(\"app/isso\");\n+  const $ = require(\"app/dom\");\n+  const config = require(\"app/config\");\n+  const template = require(\"app/template\");\n+\n+  const i18n = require(\"app/i18n\");\n+  const svg = require(\"app/svg\");\n+\n+  template.set(\"conf\", config);\n+  template.set(\"i18n\", i18n.translate);\n+  template.set(\"pluralize\", i18n.pluralize);\n+  template.set(\"svg\", svg);\n+\n+  let comment = {\n+      \"id\": 2,\n+      \"created\": 1651788192.4473603,\n+      \"mode\": 1,\n+      \"text\": \"<p>A comment with</p>\\n<pre><code>code blocks\\nNew line: preformatted\\n\\nDouble newline\\n</code></pre>\",\n+      \"author\": \"John\",\n+      \"website\": \"http://website.org\",\n+      \"hash\": \"4505c1eeda98\",\n+      \"parent\": null,\n+  }\n+\n+  // globals.offset.localTime() will be passed to i18n.ago()\n+  // localTime param will then be called as localTime.getTime()\n+  jest.mock('app/globals', () => ({\n+    offset: {\n+      localTime: jest.fn(() => ({\n+        getTime: jest.fn(() => 0),\n+      })),\n+    },\n+  }));\n+\n+  var isso_thread = $('#isso-thread');\n+  isso_thread.append('<div id=\"isso-root\"></div>');\n+\n+  isso.insert(comment, false);\n+\n+  // Will create a `.snap` file in `./__snapshots__/`.\n+  // Don't forget to check in those files when changing anything!\n+  expect(isso_thread.innerHTML).toMatchSnapshot();\n+});"
    },
    {
      "sha": "4b69572b8d5d8f4bba0f15f795d48e8a29e2b0f8",
      "filename": "isso/js/tests/unit/isso.test.js",
      "status": "modified",
      "additions": 34,
      "deletions": 15,
      "changes": 49,
      "blob_url": "https://github.com/posativ/isso/blob/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2Fisso.test.js",
      "raw_url": "https://github.com/posativ/isso/raw/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2Fisso.test.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Funit%2Fisso.test.js?ref=90042e7223521782f61f15388d4e61da9f6df8e1",
      "patch": "@@ -9,33 +9,52 @@\n \n \"use strict\";\n \n-test('Create Postbox', () => {\n+/*\n+ * Test goals:\n+ * - Test editorify()\n+ * - Test insert()\n+ * - Test insert_loader()\n+ * - Test Postbox()\n+ * Also, untangle Postbox functions from DOM element\n+ */\n+\n+test('Editorify text area', () => {\n   // Set up our document body\n   document.body.innerHTML =\n     '<div id=isso-thread></div>' +\n     // Note: `src` and `data-isso` need to be set,\n     // else `api` fails to initialize!\n     '<script src=\"http://isso.api/js/embed.min.js\" data-isso=\"/\"></script>';\n \n+  let placeholder = 'Type here'\n+  let html = \"<div class='isso-textarea isso-placeholder' contenteditable='true'>Type here</div>\"\n+\n+  jest.mock('app/i18n', () => ({\n+    translate: jest.fn(key => placeholder),\n+  }));\n+\n   const isso = require(\"app/isso\");\n   const $ = require(\"app/dom\");\n \n-  const config = require(\"app/config\");\n-  const i18n = require(\"app/i18n\");\n-  const svg = require(\"app/svg\");\n+  var textarea = $.htmlify(html);\n+  var isso_thread = $('#isso-thread');\n+  isso_thread.append(textarea);\n+  let area = document.querySelectorAll('.isso-textarea')[0];\n \n-  const template = require(\"app/template\");\n+  isso.editorify(textarea);\n+  expect(textarea.getAttribute('contentEditable')).toBe('true');\n \n-  template.set(\"conf\", config);\n-  template.set(\"i18n\", i18n.translate);\n-  template.set(\"pluralize\", i18n.pluralize);\n-  template.set(\"svg\", svg);\n+  // textarea.focus() does not work here,\n+  // Maybe some JSDOM oddities prevent addEventListener()?\n+  area.dispatchEvent(new window.MouseEvent('focus'));\n \n-  var isso_thread = $('#isso-thread');\n-  isso_thread.append('<div id=\"isso-root\"></div>');\n-  isso_thread.append(new isso.Postbox(null));\n+  // classList returns {'0': 'class1, '1': 'class2', ...}\n+  expect(textarea.innerHTML).toBe(\"\");\n+  expect(Object.values(textarea.classList)).not.toContain(\"isso-placeholder\");\n+\n+  // textarea.blur() does not work here\n+  area.dispatchEvent(new window.MouseEvent('blur'));\n \n-  // Will create a `.snap` file in `./__snapshots__/`.\n-  // Don't forget to check in those files when changing anything!\n-  expect(isso_thread.innerHTML).toMatchSnapshot();\n+  expect(Object.values(textarea.classList)).toContain(\"isso-placeholder\");\n+  expect(textarea.innerHTML).toBe(\"Type here\");\n });"
    },
    {
      "sha": "3806b12399f218f8b99b5f4e15632fdf96339b01",
      "filename": "isso/js/tests/unit/postbox.test.js",
      "status": "added",
      "additions": 41,
      "deletions": 0,
      "changes": 41,
      "blob_url": "https://github.com/posativ/isso/blob/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2Fpostbox.test.js",
      "raw_url": "https://github.com/posativ/isso/raw/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2Fpostbox.test.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Funit%2Fpostbox.test.js?ref=90042e7223521782f61f15388d4e61da9f6df8e1",
      "patch": "@@ -0,0 +1,41 @@\n+/**\n+ * @jest-environment jsdom\n+ */\n+\n+/* Keep the above exactly as-is!\n+ * https://jestjs.io/docs/configuration#testenvironment-string\n+ * https://jestjs.io/docs/configuration#testenvironmentoptions-object\n+ */\n+\n+\"use strict\";\n+\n+test('Create Postbox', () => {\n+  // Set up our document body\n+  document.body.innerHTML =\n+    '<div id=isso-thread></div>' +\n+    // Note: `src` and `data-isso` need to be set,\n+    // else `api` fails to initialize!\n+    '<script src=\"http://isso.api/js/embed.min.js\" data-isso=\"/\"></script>';\n+\n+  const isso = require(\"app/isso\");\n+  const $ = require(\"app/dom\");\n+\n+  const config = require(\"app/config\");\n+  const i18n = require(\"app/i18n\");\n+  const svg = require(\"app/svg\");\n+\n+  const template = require(\"app/template\");\n+\n+  template.set(\"conf\", config);\n+  template.set(\"i18n\", i18n.translate);\n+  template.set(\"pluralize\", i18n.pluralize);\n+  template.set(\"svg\", svg);\n+\n+  var isso_thread = $('#isso-thread');\n+  isso_thread.append('<div id=\"isso-root\"></div>');\n+  isso_thread.append(new isso.Postbox(null));\n+\n+  // Will create a `.snap` file in `./__snapshots__/`.\n+  // Don't forget to check in those files when changing anything!\n+  expect(isso_thread.innerHTML).toMatchSnapshot();\n+});"
    },
    {
      "sha": "5ab18d6de462aceb03ef379eb81f3b08d616501b",
      "filename": "isso/js/tests/unit/timezone-utc.test.js",
      "status": "added",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/posativ/isso/blob/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2Ftimezone-utc.test.js",
      "raw_url": "https://github.com/posativ/isso/raw/90042e7223521782f61f15388d4e61da9f6df8e1/isso%2Fjs%2Ftests%2Funit%2Ftimezone-utc.test.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Funit%2Ftimezone-utc.test.js?ref=90042e7223521782f61f15388d4e61da9f6df8e1",
      "patch": "@@ -0,0 +1,6 @@\n+// https://stackoverflow.com/questions/56261381/how-do-i-set-a-timezone-in-my-jest-config/56482581#56482581\n+// Requires global-setup.js\n+\n+test('Timezones should always be UTC', () => {\n+    expect(new Date().getTimezoneOffset()).toBe(0);\n+});"
    }
  ]
}
