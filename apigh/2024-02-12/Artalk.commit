{
  "sha": "cf2094667d50aed2c424494ccf851b9933d5cd79",
  "node_id": "C_kwDOCQOkhNoAKGNmMjA5NDY2N2Q1MGFlZDJjNDI0NDk0Y2NmODUxYjk5MzNkNWNkNzk",
  "commit": {
    "author": {
      "name": "qwqcode",
      "email": "qwqcode@gmail.com",
      "date": "2024-02-11T15:45:20Z"
    },
    "committer": {
      "name": "qwqcode",
      "email": "qwqcode@gmail.com",
      "date": "2024-02-11T15:47:04Z"
    },
    "message": "feat(api/domain): add GET `/conf/domain` endpoint",
    "tree": {
      "sha": "6f9967ee5a5c38ed5ee5cc431563cb0a8796a332",
      "url": "https://api.github.com/repos/ArtalkJS/Artalk/git/trees/6f9967ee5a5c38ed5ee5cc431563cb0a8796a332"
    },
    "url": "https://api.github.com/repos/ArtalkJS/Artalk/git/commits/cf2094667d50aed2c424494ccf851b9933d5cd79",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYIAB0WIQS0Ev3sdPZbHkWwzmLUbg8O6nwTagUCZcjr+QAKCRDUbg8O6nwT\nalQPAPwLP6UHufRhhEgyfVL+LrqrRh1hU9J8mhsuDHw/mswZeAD/UDqdz8xbnJpz\n6nascWLfF4Tm4aNRl/zMRU5bYtANlQs=\n=oX0C\n-----END PGP SIGNATURE-----",
      "payload": "tree 6f9967ee5a5c38ed5ee5cc431563cb0a8796a332\nparent 2cd2165f0679b489cef6d1b3de0d244fefc67364\nauthor qwqcode <qwqcode@gmail.com> 1707666320 +0800\ncommitter qwqcode <qwqcode@gmail.com> 1707666424 +0800\n\nfeat(api/domain): add GET `/conf/domain` endpoint\n"
    }
  },
  "url": "https://api.github.com/repos/ArtalkJS/Artalk/commits/cf2094667d50aed2c424494ccf851b9933d5cd79",
  "html_url": "https://github.com/ArtalkJS/Artalk/commit/cf2094667d50aed2c424494ccf851b9933d5cd79",
  "comments_url": "https://api.github.com/repos/ArtalkJS/Artalk/commits/cf2094667d50aed2c424494ccf851b9933d5cd79/comments",
  "author": {
    "login": "qwqcode",
    "id": 22412567,
    "node_id": "MDQ6VXNlcjIyNDEyNTY3",
    "avatar_url": "https://avatars.githubusercontent.com/u/22412567?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/qwqcode",
    "html_url": "https://github.com/qwqcode",
    "followers_url": "https://api.github.com/users/qwqcode/followers",
    "following_url": "https://api.github.com/users/qwqcode/following{/other_user}",
    "gists_url": "https://api.github.com/users/qwqcode/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/qwqcode/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/qwqcode/subscriptions",
    "organizations_url": "https://api.github.com/users/qwqcode/orgs",
    "repos_url": "https://api.github.com/users/qwqcode/repos",
    "events_url": "https://api.github.com/users/qwqcode/events{/privacy}",
    "received_events_url": "https://api.github.com/users/qwqcode/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "qwqcode",
    "id": 22412567,
    "node_id": "MDQ6VXNlcjIyNDEyNTY3",
    "avatar_url": "https://avatars.githubusercontent.com/u/22412567?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/qwqcode",
    "html_url": "https://github.com/qwqcode",
    "followers_url": "https://api.github.com/users/qwqcode/followers",
    "following_url": "https://api.github.com/users/qwqcode/following{/other_user}",
    "gists_url": "https://api.github.com/users/qwqcode/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/qwqcode/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/qwqcode/subscriptions",
    "organizations_url": "https://api.github.com/users/qwqcode/orgs",
    "repos_url": "https://api.github.com/users/qwqcode/repos",
    "events_url": "https://api.github.com/users/qwqcode/events{/privacy}",
    "received_events_url": "https://api.github.com/users/qwqcode/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2cd2165f0679b489cef6d1b3de0d244fefc67364",
      "url": "https://api.github.com/repos/ArtalkJS/Artalk/commits/2cd2165f0679b489cef6d1b3de0d244fefc67364",
      "html_url": "https://github.com/ArtalkJS/Artalk/commit/2cd2165f0679b489cef6d1b3de0d244fefc67364"
    }
  ],
  "stats": {
    "total": 238,
    "additions": 216,
    "deletions": 22
  },
  "files": [
    {
      "sha": "026fc341a1d4aaec0c8322fe517c0f1945486ace",
      "filename": "docs/swagger/docs.go",
      "status": "modified",
      "additions": 52,
      "deletions": 7,
      "changes": 59,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/cf2094667d50aed2c424494ccf851b9933d5cd79/docs%2Fswagger%2Fdocs.go",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/cf2094667d50aed2c424494ccf851b9933d5cd79/docs%2Fswagger%2Fdocs.go",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/docs%2Fswagger%2Fdocs.go?ref=cf2094667d50aed2c424494ccf851b9933d5cd79",
      "patch": "@@ -787,6 +787,35 @@ const docTemplate = `{\n                 }\n             }\n         },\n+        \"/conf/domain\": {\n+            \"get\": {\n+                \"description\": \"Get Domain Info\",\n+                \"produces\": [\n+                    \"application/json\"\n+                ],\n+                \"tags\": [\n+                    \"System\"\n+                ],\n+                \"summary\": \"Get Domain Info\",\n+                \"operationId\": \"GetDomain\",\n+                \"parameters\": [\n+                    {\n+                        \"type\": \"string\",\n+                        \"description\": \"Domain URL\",\n+                        \"name\": \"url\",\n+                        \"in\": \"query\"\n+                    }\n+                ],\n+                \"responses\": {\n+                    \"200\": {\n+                        \"description\": \"OK\",\n+                        \"schema\": {\n+                            \"$ref\": \"#/definitions/handler.ResponseConfDomain\"\n+                        }\n+                    }\n+                }\n+            }\n+        },\n         \"/notifies\": {\n             \"get\": {\n                 \"description\": \"Get a list of notifies for user\",\n@@ -2387,7 +2416,7 @@ const docTemplate = `{\n                     \"application/json\"\n                 ],\n                 \"tags\": [\n-                    \"Account\"\n+                    \"Auth\"\n                 ],\n                 \"summary\": \"Get User Info\",\n                 \"operationId\": \"GetUser\",\n@@ -2443,7 +2472,7 @@ const docTemplate = `{\n                     \"application/json\"\n                 ],\n                 \"tags\": [\n-                    \"Account\"\n+                    \"Auth\"\n                 ],\n                 \"summary\": \"Get Access Token\",\n                 \"operationId\": \"Login\",\n@@ -2494,8 +2523,8 @@ const docTemplate = `{\n                             ]\n                         }\n                     },\n-                    \"403\": {\n-                        \"description\": \"Forbidden\",\n+                    \"401\": {\n+                        \"description\": \"Unauthorized\",\n                         \"schema\": {\n                             \"allOf\": [\n                                 {\n@@ -2545,7 +2574,7 @@ const docTemplate = `{\n                     \"application/json\"\n                 ],\n                 \"tags\": [\n-                    \"Account\"\n+                    \"Auth\"\n                 ],\n                 \"summary\": \"Get Login Status\",\n                 \"operationId\": \"GetUserStatus\",\n@@ -3545,8 +3574,7 @@ const docTemplate = `{\n                 \"is_pinned\",\n                 \"page_key\",\n                 \"rid\",\n-                \"site_name\",\n-                \"ua\"\n+                \"site_name\"\n             ],\n             \"properties\": {\n                 \"content\": {\n@@ -4184,6 +4212,23 @@ const docTemplate = `{\n                 }\n             }\n         },\n+        \"handler.ResponseConfDomain\": {\n+            \"type\": \"object\",\n+            \"required\": [\n+                \"is_trusted\",\n+                \"origin\"\n+            ],\n+            \"properties\": {\n+                \"is_trusted\": {\n+                    \"description\": \"Is the domain trusted\",\n+                    \"type\": \"boolean\"\n+                },\n+                \"origin\": {\n+                    \"description\": \"The origin of the domain\",\n+                    \"type\": \"string\"\n+                }\n+            }\n+        },\n         \"handler.ResponseNotifyList\": {\n             \"type\": \"object\",\n             \"required\": ["
    },
    {
      "sha": "8a9320c3c66b4fb5c1250679c75a16b16d2ac2ee",
      "filename": "docs/swagger/swagger.json",
      "status": "modified",
      "additions": 52,
      "deletions": 7,
      "changes": 59,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/cf2094667d50aed2c424494ccf851b9933d5cd79/docs%2Fswagger%2Fswagger.json",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/cf2094667d50aed2c424494ccf851b9933d5cd79/docs%2Fswagger%2Fswagger.json",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/docs%2Fswagger%2Fswagger.json?ref=cf2094667d50aed2c424494ccf851b9933d5cd79",
      "patch": "@@ -780,6 +780,35 @@\n                 }\n             }\n         },\n+        \"/conf/domain\": {\n+            \"get\": {\n+                \"description\": \"Get Domain Info\",\n+                \"produces\": [\n+                    \"application/json\"\n+                ],\n+                \"tags\": [\n+                    \"System\"\n+                ],\n+                \"summary\": \"Get Domain Info\",\n+                \"operationId\": \"GetDomain\",\n+                \"parameters\": [\n+                    {\n+                        \"type\": \"string\",\n+                        \"description\": \"Domain URL\",\n+                        \"name\": \"url\",\n+                        \"in\": \"query\"\n+                    }\n+                ],\n+                \"responses\": {\n+                    \"200\": {\n+                        \"description\": \"OK\",\n+                        \"schema\": {\n+                            \"$ref\": \"#/definitions/handler.ResponseConfDomain\"\n+                        }\n+                    }\n+                }\n+            }\n+        },\n         \"/notifies\": {\n             \"get\": {\n                 \"description\": \"Get a list of notifies for user\",\n@@ -2380,7 +2409,7 @@\n                     \"application/json\"\n                 ],\n                 \"tags\": [\n-                    \"Account\"\n+                    \"Auth\"\n                 ],\n                 \"summary\": \"Get User Info\",\n                 \"operationId\": \"GetUser\",\n@@ -2436,7 +2465,7 @@\n                     \"application/json\"\n                 ],\n                 \"tags\": [\n-                    \"Account\"\n+                    \"Auth\"\n                 ],\n                 \"summary\": \"Get Access Token\",\n                 \"operationId\": \"Login\",\n@@ -2487,8 +2516,8 @@\n                             ]\n                         }\n                     },\n-                    \"403\": {\n-                        \"description\": \"Forbidden\",\n+                    \"401\": {\n+                        \"description\": \"Unauthorized\",\n                         \"schema\": {\n                             \"allOf\": [\n                                 {\n@@ -2538,7 +2567,7 @@\n                     \"application/json\"\n                 ],\n                 \"tags\": [\n-                    \"Account\"\n+                    \"Auth\"\n                 ],\n                 \"summary\": \"Get Login Status\",\n                 \"operationId\": \"GetUserStatus\",\n@@ -3538,8 +3567,7 @@\n                 \"is_pinned\",\n                 \"page_key\",\n                 \"rid\",\n-                \"site_name\",\n-                \"ua\"\n+                \"site_name\"\n             ],\n             \"properties\": {\n                 \"content\": {\n@@ -4177,6 +4205,23 @@\n                 }\n             }\n         },\n+        \"handler.ResponseConfDomain\": {\n+            \"type\": \"object\",\n+            \"required\": [\n+                \"is_trusted\",\n+                \"origin\"\n+            ],\n+            \"properties\": {\n+                \"is_trusted\": {\n+                    \"description\": \"Is the domain trusted\",\n+                    \"type\": \"boolean\"\n+                },\n+                \"origin\": {\n+                    \"description\": \"The origin of the domain\",\n+                    \"type\": \"string\"\n+                }\n+            }\n+        },\n         \"handler.ResponseNotifyList\": {\n             \"type\": \"object\",\n             \"required\": ["
    },
    {
      "sha": "5baa71becf535e21565d4c9b44d93b02884b19cf",
      "filename": "docs/swagger/swagger.yaml",
      "status": "modified",
      "additions": 36,
      "deletions": 6,
      "changes": 42,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/cf2094667d50aed2c424494ccf851b9933d5cd79/docs%2Fswagger%2Fswagger.yaml",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/cf2094667d50aed2c424494ccf851b9933d5cd79/docs%2Fswagger%2Fswagger.yaml",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/docs%2Fswagger%2Fswagger.yaml?ref=cf2094667d50aed2c424494ccf851b9933d5cd79",
      "patch": "@@ -345,7 +345,6 @@ definitions:\n     - page_key\n     - rid\n     - site_name\n-    - ua\n     type: object\n   handler.ParamsEmailSend:\n     properties:\n@@ -764,6 +763,18 @@ definitions:\n     - vote_down\n     - vote_up\n     type: object\n+  handler.ResponseConfDomain:\n+    properties:\n+      is_trusted:\n+        description: Is the domain trusted\n+        type: boolean\n+      origin:\n+        description: The origin of the domain\n+        type: string\n+    required:\n+    - is_trusted\n+    - origin\n+    type: object\n   handler.ResponseNotifyList:\n     properties:\n       count:\n@@ -1560,6 +1571,25 @@ paths:\n       summary: Get System Configs\n       tags:\n       - System\n+  /conf/domain:\n+    get:\n+      description: Get Domain Info\n+      operationId: GetDomain\n+      parameters:\n+      - description: Domain URL\n+        in: query\n+        name: url\n+        type: string\n+      produces:\n+      - application/json\n+      responses:\n+        \"200\":\n+          description: OK\n+          schema:\n+            $ref: '#/definitions/handler.ResponseConfDomain'\n+      summary: Get Domain Info\n+      tags:\n+      - System\n   /notifies:\n     get:\n       consumes:\n@@ -2511,7 +2541,7 @@ paths:\n       - ApiKeyAuth: []\n       summary: Get User Info\n       tags:\n-      - Account\n+      - Auth\n   /user/access_token:\n     post:\n       consumes:\n@@ -2548,8 +2578,8 @@ paths:\n                 msg:\n                   type: string\n               type: object\n-        \"403\":\n-          description: Forbidden\n+        \"401\":\n+          description: Unauthorized\n           schema:\n             allOf:\n             - $ref: '#/definitions/handler.Map'\n@@ -2568,7 +2598,7 @@ paths:\n               type: object\n       summary: Get Access Token\n       tags:\n-      - Account\n+      - Auth\n   /user/status:\n     get:\n       description: Get user login status by header Authorization\n@@ -2593,7 +2623,7 @@ paths:\n       - ApiKeyAuth: []\n       summary: Get Login Status\n       tags:\n-      - Account\n+      - Auth\n   /users:\n     post:\n       consumes:"
    },
    {
      "sha": "c84705b4563375c583d9deecaf53c1dbd8f77c77",
      "filename": "server/handler/conf_domain.go",
      "status": "added",
      "additions": 42,
      "deletions": 0,
      "changes": 42,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/cf2094667d50aed2c424494ccf851b9933d5cd79/server%2Fhandler%2Fconf_domain.go",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/cf2094667d50aed2c424494ccf851b9933d5cd79/server%2Fhandler%2Fconf_domain.go",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/server%2Fhandler%2Fconf_domain.go?ref=cf2094667d50aed2c424494ccf851b9933d5cd79",
      "patch": "@@ -0,0 +1,42 @@\n+package handler\n+\n+import (\n+\t\"net/url\"\n+\n+\t\"github.com/ArtalkJS/Artalk/internal/core\"\n+\t\"github.com/ArtalkJS/Artalk/server/common\"\n+\t\"github.com/ArtalkJS/Artalk/server/middleware\"\n+\t\"github.com/gofiber/fiber/v2\"\n+)\n+\n+type ResponseConfDomain struct {\n+\tOrigin    string `json:\"origin\"`     // The origin of the domain\n+\tIsTrusted bool   `json:\"is_trusted\"` // Is the domain trusted\n+}\n+\n+// @Id            GetDomain\n+// @Summary       Get Domain Info\n+// @Description   Get Domain Info\n+// @Tags          System\n+// @Produce       json\n+// @Param         url query string false \"Domain URL\"\n+// @Success       200  {object}  ResponseConfDomain\n+// @Router        /conf/domain  [get]\n+func ConfDomain(app *core.App, router fiber.Router) {\n+\trouter.Get(\"/conf/domain\", func(c *fiber.Ctx) error {\n+\t\tdomainURL := c.Query(\"url\")\n+\t\tif domainURL == \"\" {\n+\t\t\tdomainURL = c.Get(\"Origin\")\n+\t\t}\n+\t\tu, err := url.Parse(domainURL)\n+\t\tif err != nil {\n+\t\t\treturn common.RespError(c, 400, \"Invalid URL\")\n+\t\t}\n+\t\torigin := u.Scheme + \"://\" + u.Host\n+\t\tisTrusted := middleware.CheckOriginTrusted(app, origin)\n+\t\treturn common.RespData(c, ResponseConfDomain{\n+\t\t\tIsTrusted: isTrusted,\n+\t\t\tOrigin:    origin,\n+\t\t})\n+\t})\n+}"
    },
    {
      "sha": "2c4c31b80cddc23e433c022ed61f34951bdd6169",
      "filename": "server/middleware/cors.go",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/cf2094667d50aed2c424494ccf851b9933d5cd79/server%2Fmiddleware%2Fcors.go",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/cf2094667d50aed2c424494ccf851b9933d5cd79/server%2Fmiddleware%2Fcors.go",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/server%2Fmiddleware%2Fcors.go?ref=cf2094667d50aed2c424494ccf851b9933d5cd79",
      "patch": "@@ -36,14 +36,14 @@ func getCorsAllowOrigins(app *core.App) []string {\n \treturn allowOrigins\n }\n \n-func isOriginAllowed(app *core.App, origin string) bool {\n+func CheckOriginTrusted(app *core.App, origin string) bool {\n \treturn slices.Contains(getCorsAllowOrigins(app), origin)\n }\n \n func CorsMiddleware(app *core.App) func(*fiber.Ctx) error {\n \treturn cors.New(cors.Config{\n \t\tAllowOriginsFunc: func(origin string) bool {\n-\t\t\treturn isOriginAllowed(app, origin)\n+\t\t\treturn CheckOriginTrusted(app, origin)\n \t\t},\n \t})\n }"
    },
    {
      "sha": "f1748b8aba35bb7ff1fcca11aa585b66d9b5f761",
      "filename": "server/server.go",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/cf2094667d50aed2c424494ccf851b9933d5cd79/server%2Fserver.go",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/cf2094667d50aed2c424494ccf851b9933d5cd79/server%2Fserver.go",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/server%2Fserver.go?ref=cf2094667d50aed2c424494ccf851b9933d5cd79",
      "patch": "@@ -90,6 +90,7 @@ func Serve(app *core.App) (*fiber.App, error) {\n \n \t\th.Conf(app, api)\n \t\th.Version(app, api)\n+\t\th.ConfDomain(app, api)\n \n \t\t// captcha\n \t\th.Captcha(app, api)"
    },
    {
      "sha": "98e5d61542e24e9478fcf9d67b1ca6eab701b46d",
      "filename": "ui/artalk/src/api/v2.ts",
      "status": "modified",
      "additions": 31,
      "deletions": 0,
      "changes": 31,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/cf2094667d50aed2c424494ccf851b9933d5cd79/ui%2Fartalk%2Fsrc%2Fapi%2Fv2.ts",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/cf2094667d50aed2c424494ccf851b9933d5cd79/ui%2Fartalk%2Fsrc%2Fapi%2Fv2.ts",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/ui%2Fartalk%2Fsrc%2Fapi%2Fv2.ts?ref=cf2094667d50aed2c424494ccf851b9933d5cd79",
      "patch": "@@ -373,6 +373,13 @@ export interface HandlerResponseCommentUpdate {\n   vote_up: number\n }\n \n+export interface HandlerResponseConfDomain {\n+  /** Is the domain trusted */\n+  is_trusted: boolean\n+  /** The origin of the domain */\n+  origin: string\n+}\n+\n export interface HandlerResponseNotifyList {\n   count: number\n   notifies: EntityCookedNotify[]\n@@ -1105,6 +1112,30 @@ export class Api<SecurityDataType extends unknown> extends HttpClient<SecurityDa\n         format: 'json',\n         ...params,\n       }),\n+\n+    /**\n+     * @description Get Domain Info\n+     *\n+     * @tags System\n+     * @name GetDomain\n+     * @summary Get Domain Info\n+     * @request GET:/conf/domain\n+     * @response `200` `HandlerResponseConfDomain` OK\n+     */\n+    getDomain: (\n+      query?: {\n+        /** Domain URL */\n+        url?: string\n+      },\n+      params: RequestParams = {},\n+    ) =>\n+      this.request<HandlerResponseConfDomain, any>({\n+        path: `/conf/domain`,\n+        method: 'GET',\n+        query: query,\n+        format: 'json',\n+        ...params,\n+      }),\n   }\n   notifies = {\n     /**"
    }
  ]
}
