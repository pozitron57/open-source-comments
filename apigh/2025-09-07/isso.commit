{
  "sha": "60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca",
  "node_id": "C_kwDOAF-mA9oAKDYwZWM4OTA2MTVlOWM5YTc1MTNmZGFmNmFlMjdhMmJjOGQ4Nzg0Y2E",
  "commit": {
    "author": {
      "name": "Jelmer Vernooĳ",
      "email": "jelmer@apache.org",
      "date": "2025-08-14T07:09:25Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2025-08-14T07:09:25Z"
    },
    "message": "Merge pull request #1035 from ggtylerr/master\n\nserver: Set reply sorting to 'oldest'",
    "tree": {
      "sha": "07fd30e26dbb6ab72da57f839fc43a7aaf76a893",
      "url": "https://api.github.com/repos/isso-comments/isso/git/trees/07fd30e26dbb6ab72da57f839fc43a7aaf76a893"
    },
    "url": "https://api.github.com/repos/isso-comments/isso/git/commits/60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsFcBAABCAAQBQJonYulCRC1aQ7uu5UhlAAAdUYQAFyLHUAziy7fC26kswb9NUNB\noi4FzEMbIf44aZsfZ6AgwlBFmlbCcEXMdnZPxXbObV+nYZLglKqlz63xXcR//qyJ\ns33jYjcxzKR8KKEcZTp3toHjQyBqh/kWwtjIoI1On4asZxWKjdGEQ0isES80aU+V\nXovEW4LZ/KGa13YsjUs8DQGsbpx5BwJietW+DMigUs0F43HZvq6/5hzBtEwN6Whc\n4ez1vquictTCO74sh/EnbVQ4E9KcPexSoL/yJk41TCl+VhjqdXm38Gm7tV4bChM7\nKhCMNELSe4gujCgYGq5sRiIk8+m0jatmfGmoceD0kabp5w9b66/OXeREjeh4ZjzI\ntKTLwXCfLEA/CEFwWJoU7hDV2n/uPTD0M4Nqbc40sQK3GC0gwygEHcYanO7FkDt4\nyvVtrQ+9QpMWso2dj1RRiR2YpFwlvyFrNzEFO2QvXO/KHPfIekGXoqdFKP4D7JBD\nHlCBPpkTHkMeR7X8bIr7EObJGaDuEHuMOWR3ziowU11n6aVQc0uh6+IgWKEARmY6\nZGShKevuTdyCLGTgaL5tuglcG7qYnXdCHPTudqEK0mVA1ZEneqUl1X+9uPu3KSNg\nA5Gd/+gjj3StpsoRtHARck4iP29FYeo1USL2C2mq2iHyAgnbEAcv10tvMApuHOup\nxkmaSIrqrej1w4Q78coy\n=+DT2\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 07fd30e26dbb6ab72da57f839fc43a7aaf76a893\nparent d9fadd22d584c1d1f3a9037f0411ed57ef933d56\nparent 400e4f7ca9bddea1fd024957f1aa169a17451d1f\nauthor Jelmer Vernooĳ <jelmer@apache.org> 1755155365 +0100\ncommitter GitHub <noreply@github.com> 1755155365 +0100\n\nMerge pull request #1035 from ggtylerr/master\n\nserver: Set reply sorting to 'oldest'",
      "verified_at": "2025-08-14T07:09:26Z"
    }
  },
  "url": "https://api.github.com/repos/isso-comments/isso/commits/60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca",
  "html_url": "https://github.com/isso-comments/isso/commit/60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca",
  "comments_url": "https://api.github.com/repos/isso-comments/isso/commits/60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca/comments",
  "author": {
    "login": "jelmer",
    "id": 49032,
    "node_id": "MDQ6VXNlcjQ5MDMy",
    "avatar_url": "https://avatars.githubusercontent.com/u/49032?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jelmer",
    "html_url": "https://github.com/jelmer",
    "followers_url": "https://api.github.com/users/jelmer/followers",
    "following_url": "https://api.github.com/users/jelmer/following{/other_user}",
    "gists_url": "https://api.github.com/users/jelmer/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jelmer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jelmer/subscriptions",
    "organizations_url": "https://api.github.com/users/jelmer/orgs",
    "repos_url": "https://api.github.com/users/jelmer/repos",
    "events_url": "https://api.github.com/users/jelmer/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jelmer/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d9fadd22d584c1d1f3a9037f0411ed57ef933d56",
      "url": "https://api.github.com/repos/isso-comments/isso/commits/d9fadd22d584c1d1f3a9037f0411ed57ef933d56",
      "html_url": "https://github.com/isso-comments/isso/commit/d9fadd22d584c1d1f3a9037f0411ed57ef933d56"
    },
    {
      "sha": "400e4f7ca9bddea1fd024957f1aa169a17451d1f",
      "url": "https://api.github.com/repos/isso-comments/isso/commits/400e4f7ca9bddea1fd024957f1aa169a17451d1f",
      "html_url": "https://github.com/isso-comments/isso/commit/400e4f7ca9bddea1fd024957f1aa169a17451d1f"
    }
  ],
  "stats": {
    "total": 31,
    "additions": 17,
    "deletions": 14
  },
  "files": [
    {
      "sha": "0126f04bdc20f4bf86184d80c2a0b3d5ec519509",
      "filename": "CHANGES.rst",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/isso-comments/isso/blob/60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca/CHANGES.rst",
      "raw_url": "https://github.com/isso-comments/isso/raw/60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca/CHANGES.rst",
      "contents_url": "https://api.github.com/repos/isso-comments/isso/contents/CHANGES.rst?ref=60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca",
      "patch": "@@ -57,6 +57,7 @@ Bugfixes & Improvements\n - Python 3.12 support (`#1015`_, ix5)\n - Disable Postbox submit button on click, enable after response (`#993`_, pkvach)\n - Document title parameter and improve error handling for /new API (`#1058`_, pkvach)\n+- Set reply sorting to always be oldest (`#1035`_, ggtylerr)\n \n .. _#951: https://github.com/posativ/isso/pull/951\n .. _#967: https://github.com/posativ/isso/pull/967\n@@ -71,6 +72,7 @@ Bugfixes & Improvements\n .. _#1019: https://github.com/isso-comments/isso/pull/1019\n .. _#1015: https://github.com/isso-comments/isso/pull/1015\n .. _#993: https://github.com/isso-comments/isso/pull/993\n+.. _#1035: https://github.com/isso-comments/isso/pull/1035\n .. _#1058: https://github.com/isso-comments/isso/pull/1058\n \n 0.13.1.dev0 (2023-02-05)"
    },
    {
      "sha": "762d9e9ef7c17c356bf24eef4efa169d38ec4581",
      "filename": "docs/docs/reference/client-config.rst",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/isso-comments/isso/blob/60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca/docs%2Fdocs%2Freference%2Fclient-config.rst",
      "raw_url": "https://github.com/isso-comments/isso/raw/60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca/docs%2Fdocs%2Freference%2Fclient-config.rst",
      "contents_url": "https://api.github.com/repos/isso-comments/isso/contents/docs%2Fdocs%2Freference%2Fclient-config.rst?ref=60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca",
      "patch": "@@ -267,7 +267,8 @@ data-isso-sorting\n     - ``oldest``: Bring oldest comments to the top\n     - ``upvotes``: Bring most liked comments to the top\n \n-    Default sorting is ``oldest``.\n+    Default sorting is ``oldest``. As of 0.13.1, replies are always sorted as\n+    ``oldest``.\n \n     .. versionadded:: 0.13.1\n "
    },
    {
      "sha": "327e209ce6ced53dd79c2405bcf13ac2f7c1bc53",
      "filename": "isso/db/comments.py",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/isso-comments/isso/blob/60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca/isso%2Fdb%2Fcomments.py",
      "raw_url": "https://github.com/isso-comments/isso/raw/60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca/isso%2Fdb%2Fcomments.py",
      "contents_url": "https://api.github.com/repos/isso-comments/isso/contents/isso%2Fdb%2Fcomments.py?ref=60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca",
      "patch": "@@ -217,16 +217,16 @@ def fetchall(self, mode=5, after=0, parent='any', order_by='id',\n \n         # custom sanitization\n         if order_by not in ['id', 'created', 'modified', 'likes', 'dislikes', 'tid']:\n-            sql.append('ORDER BY ')\n-            sql.append(\"comments.created\")\n+            sql.append('ORDER BY CASE WHEN comments.parent IS NOT NULL THEN comments.created END, ')\n+            sql.append('comments.created')\n             if not asc:\n                 sql.append(' DESC')\n         else:\n-            sql.append('ORDER BY ')\n+            sql.append('ORDER BY CASE WHEN comments.parent IS NOT NULL THEN comments.created END, ')\n             sql.append('comments.' + order_by)\n             if not asc:\n                 sql.append(' DESC')\n-            sql.append(\", comments.created\")\n+            sql.append(', comments.created')\n \n         if limit:\n             sql.append('LIMIT ?,?')\n@@ -257,8 +257,8 @@ def fetch(self, uri, mode=5, after=0, parent='any',\n \n         # custom sanitization\n         if order_by not in ['id', 'created', 'modified', 'likes', 'dislikes', 'karma']:\n-            order_by = 'id'\n-        sql.append('ORDER BY ')\n+            order_by = 'created'\n+        sql.append('ORDER BY CASE WHEN comments.parent IS NOT NULL THEN comments.created END, ')\n         sql.append(order_by)\n         if not asc:\n             sql.append(' DESC')"
    },
    {
      "sha": "a00fc086c0d6242875f09d5931aeade3db0c5e99",
      "filename": "isso/tests/test_comments.py",
      "status": "modified",
      "additions": 7,
      "deletions": 7,
      "changes": 14,
      "blob_url": "https://github.com/isso-comments/isso/blob/60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca/isso%2Ftests%2Ftest_comments.py",
      "raw_url": "https://github.com/isso-comments/isso/raw/60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca/isso%2Ftests%2Ftest_comments.py",
      "contents_url": "https://api.github.com/repos/isso-comments/isso/contents/isso%2Ftests%2Ftest_comments.py?ref=60ec890615e9c9a7513fdaf6ae27a2bc8d8784ca",
      "patch": "@@ -347,10 +347,10 @@ def testGetSortedByNewestWithNested(self):\n \n         rv = loads(r.data)\n         self.assertEqual(len(rv['replies']), 1)\n-        # assert order of nested comments is newest first\n+        # assert order of nested comments is oldest first\n         self.assertEqual(\n             [comment['id'] for comment in rv['replies'][0]['replies']],\n-            [6, 5, 4, 3, 2]\n+            [2, 3, 4, 5, 6]\n         )\n \n     def testGetSortedByUpvotesWithNested(self):\n@@ -369,10 +369,10 @@ def testGetSortedByUpvotesWithNested(self):\n \n         rv = loads(r.data)\n         self.assertEqual(len(rv['replies']), 1)\n-        # assert order of nested comments is newest first\n+        # assert order of nested comments is oldest first\n         self.assertEqual(\n             [comment['id'] for comment in rv['replies'][0]['replies']],\n-            [6, 3, 2, 4, 5]\n+            [2, 3, 4, 5, 6]\n         )\n \n     def testUpdate(self):\n@@ -559,15 +559,15 @@ def testFeed(self):\n \n         rv = self.get('/feed?uri=%2Fpath%2F')\n         self.assertEqual(rv.status_code, 200)\n-        self.assertEqual(rv.headers['ETag'], '\"1-2\"')\n+        self.assertEqual(rv.headers['ETag'], '\"1-1\"')\n         data = rv.data.decode('utf-8')\n         data = re.sub('[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}\\\\.[0-9]+Z',\n                       '2018-04-01T10:00:00Z', data)\n         self.maxDiff = None\n         # Two accepted outputs, since different versions of Python sort attributes in different order.\n         self.assertIn(data, [\"\"\"<?xml version=\\'1.0\\' encoding=\\'utf-8\\'?>\n-<feed xmlns=\"http://www.w3.org/2005/Atom\" xmlns:thr=\"http://purl.org/syndication/thread/1.0\"><updated>2018-04-01T10:00:00Z</updated><id>tag:example.org,2018:/isso/thread/path/</id><title>Comments for example.org/path/</title><entry><id>tag:example.org,2018:/isso/1/2</id><title>Comment #2</title><updated>2018-04-01T10:00:00Z</updated><author><name /></author><link href=\"https://example.org/path/#isso-2\" /><content type=\"html\">&lt;p&gt;&lt;em&gt;Second&lt;/em&gt;&lt;/p&gt;</content><thr:in-reply-to href=\"https://example.org/path/#isso-1\" ref=\"tag:example.org,2018:/isso/1/1\" /></entry><entry><id>tag:example.org,2018:/isso/1/1</id><title>Comment #1</title><updated>2018-04-01T10:00:00Z</updated><author><name /></author><link href=\"https://example.org/path/#isso-1\" /><content type=\"html\">&lt;p&gt;First&lt;/p&gt;</content></entry></feed>\"\"\", \"\"\"<?xml version=\\'1.0\\' encoding=\\'utf-8\\'?>\n-<feed xmlns=\"http://www.w3.org/2005/Atom\" xmlns:thr=\"http://purl.org/syndication/thread/1.0\"><updated>2018-04-01T10:00:00Z</updated><id>tag:example.org,2018:/isso/thread/path/</id><title>Comments for example.org/path/</title><entry><id>tag:example.org,2018:/isso/1/2</id><title>Comment #2</title><updated>2018-04-01T10:00:00Z</updated><author><name /></author><link href=\"https://example.org/path/#isso-2\" /><content type=\"html\">&lt;p&gt;&lt;em&gt;Second&lt;/em&gt;&lt;/p&gt;</content><thr:in-reply-to ref=\"tag:example.org,2018:/isso/1/1\" href=\"https://example.org/path/#isso-1\" /></entry><entry><id>tag:example.org,2018:/isso/1/1</id><title>Comment #1</title><updated>2018-04-01T10:00:00Z</updated><author><name /></author><link href=\"https://example.org/path/#isso-1\" /><content type=\"html\">&lt;p&gt;First&lt;/p&gt;</content></entry></feed>\"\"\"])\n+<feed xmlns=\"http://www.w3.org/2005/Atom\" xmlns:thr=\"http://purl.org/syndication/thread/1.0\"><updated>2018-04-01T10:00:00Z</updated><id>tag:example.org,2018:/isso/thread/path/</id><title>Comments for example.org/path/</title><entry><id>tag:example.org,2018:/isso/1/1</id><title>Comment #1</title><updated>2018-04-01T10:00:00Z</updated><author><name /></author><link href=\"https://example.org/path/#isso-1\" /><content type=\"html\">&lt;p&gt;First&lt;/p&gt;</content></entry><entry><id>tag:example.org,2018:/isso/1/2</id><title>Comment #2</title><updated>2018-04-01T10:00:00Z</updated><author><name /></author><link href=\"https://example.org/path/#isso-2\" /><content type=\"html\">&lt;p&gt;&lt;em&gt;Second&lt;/em&gt;&lt;/p&gt;</content><thr:in-reply-to href=\"https://example.org/path/#isso-1\" ref=\"tag:example.org,2018:/isso/1/1\" /></entry></feed>\"\"\", \"\"\"<?xml version=\\'1.0\\' encoding=\\'utf-8\\'?>\n+<feed xmlns=\"http://www.w3.org/2005/Atom\" xmlns:thr=\"http://purl.org/syndication/thread/1.0\"><updated>2018-04-01T10:00:00Z</updated><id>tag:example.org,2018:/isso/thread/path/</id><title>Comments for example.org/path/</title><entry><id>tag:example.org,2018:/isso/1/1</id><title>Comment #1</title><updated>2018-04-01T10:00:00Z</updated><author><name /></author><link href=\"https://example.org/path/#isso-1\" /><content type=\"html\">&lt;p&gt;First&lt;/p&gt;</content></entry><entry><id>tag:example.org,2018:/isso/1/2</id><title>Comment #2</title><updated>2018-04-01T10:00:00Z</updated><author><name /></author><link href=\"https://example.org/path/#isso-2\" /><content type=\"html\">&lt;p&gt;&lt;em&gt;Second&lt;/em&gt;&lt;/p&gt;</content><thr:in-reply-to ref=\"tag:example.org,2018:/isso/1/1\" href=\"https://example.org/path/#isso-1\" /></entry></feed>\"\"\"])\n \n     def testCounts(self):\n "
    }
  ]
}
