{
  "sha": "bb218d0ba4f19576ea796fdf4d617af7aca4fde3",
  "node_id": "C_kwDOCQOkhNoAKGJiMjE4ZDBiYTRmMTk1NzZlYTc5NmZkZjRkNjE3YWY3YWNhNGZkZTM",
  "commit": {
    "author": {
      "name": "qwqcode",
      "email": "qwqcode@gmail.com",
      "date": "2024-05-15T13:37:03Z"
    },
    "committer": {
      "name": "qwqcode",
      "email": "qwqcode@gmail.com",
      "date": "2024-05-15T13:37:16Z"
    },
    "message": "docs(ip_region): add instructions for obtaining accurate IP under proxy",
    "tree": {
      "sha": "432fb4597684cb87c92e8aa024ff62a0709fa9f9",
      "url": "https://api.github.com/repos/ArtalkJS/Artalk/git/trees/432fb4597684cb87c92e8aa024ff62a0709fa9f9"
    },
    "url": "https://api.github.com/repos/ArtalkJS/Artalk/git/commits/bb218d0ba4f19576ea796fdf4d617af7aca4fde3",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYIAB0WIQS0Ev3sdPZbHkWwzmLUbg8O6nwTagUCZkS6ngAKCRDUbg8O6nwT\nau7HAP46R6gfOIDGvDYxZ0zcSAscTlsOHBqPTMdcDkBnE9LBawEAnYMWy7wBpkY8\ndd3RLE6mr6MY1i6alUxxMrs3ub81Rw4=\n=Imym\n-----END PGP SIGNATURE-----",
      "payload": "tree 432fb4597684cb87c92e8aa024ff62a0709fa9f9\nparent 984071d4b65bbee5b1a21128f3718901a348ca32\nauthor qwqcode <qwqcode@gmail.com> 1715780223 +0800\ncommitter qwqcode <qwqcode@gmail.com> 1715780236 +0800\n\ndocs(ip_region): add instructions for obtaining accurate IP under proxy\n"
    }
  },
  "url": "https://api.github.com/repos/ArtalkJS/Artalk/commits/bb218d0ba4f19576ea796fdf4d617af7aca4fde3",
  "html_url": "https://github.com/ArtalkJS/Artalk/commit/bb218d0ba4f19576ea796fdf4d617af7aca4fde3",
  "comments_url": "https://api.github.com/repos/ArtalkJS/Artalk/commits/bb218d0ba4f19576ea796fdf4d617af7aca4fde3/comments",
  "author": {
    "login": "qwqcode",
    "id": 22412567,
    "node_id": "MDQ6VXNlcjIyNDEyNTY3",
    "avatar_url": "https://avatars.githubusercontent.com/u/22412567?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/qwqcode",
    "html_url": "https://github.com/qwqcode",
    "followers_url": "https://api.github.com/users/qwqcode/followers",
    "following_url": "https://api.github.com/users/qwqcode/following{/other_user}",
    "gists_url": "https://api.github.com/users/qwqcode/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/qwqcode/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/qwqcode/subscriptions",
    "organizations_url": "https://api.github.com/users/qwqcode/orgs",
    "repos_url": "https://api.github.com/users/qwqcode/repos",
    "events_url": "https://api.github.com/users/qwqcode/events{/privacy}",
    "received_events_url": "https://api.github.com/users/qwqcode/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "qwqcode",
    "id": 22412567,
    "node_id": "MDQ6VXNlcjIyNDEyNTY3",
    "avatar_url": "https://avatars.githubusercontent.com/u/22412567?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/qwqcode",
    "html_url": "https://github.com/qwqcode",
    "followers_url": "https://api.github.com/users/qwqcode/followers",
    "following_url": "https://api.github.com/users/qwqcode/following{/other_user}",
    "gists_url": "https://api.github.com/users/qwqcode/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/qwqcode/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/qwqcode/subscriptions",
    "organizations_url": "https://api.github.com/users/qwqcode/orgs",
    "repos_url": "https://api.github.com/users/qwqcode/repos",
    "events_url": "https://api.github.com/users/qwqcode/events{/privacy}",
    "received_events_url": "https://api.github.com/users/qwqcode/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "984071d4b65bbee5b1a21128f3718901a348ca32",
      "url": "https://api.github.com/repos/ArtalkJS/Artalk/commits/984071d4b65bbee5b1a21128f3718901a348ca32",
      "html_url": "https://github.com/ArtalkJS/Artalk/commit/984071d4b65bbee5b1a21128f3718901a348ca32"
    }
  ],
  "stats": {
    "total": 24,
    "additions": 22,
    "deletions": 2
  },
  "files": [
    {
      "sha": "e345f8dbfecfdb3414a170f6973ecfa63f5c110a",
      "filename": "docs/docs/guide/backend/config.md",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/bb218d0ba4f19576ea796fdf4d617af7aca4fde3/docs%2Fdocs%2Fguide%2Fbackend%2Fconfig.md",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/bb218d0ba4f19576ea796fdf4d617af7aca4fde3/docs%2Fdocs%2Fguide%2Fbackend%2Fconfig.md",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/docs%2Fdocs%2Fguide%2Fbackend%2Fconfig.md?ref=bb218d0ba4f19576ea796fdf4d617af7aca4fde3",
      "patch": "@@ -113,6 +113,16 @@ db:\n \n 更多内容参考：[@go-sql-driver/mysql:README.md](https://github.com/go-sql-driver/mysql)\n \n+## 服务器 `http`\n+\n+```yaml\n+http:\n+  # 请求体大小限制 (单位：MB)\n+  body_limit: 100\n+  # 代理标头名 (当使用 CDN 时填写 `X-Forwarded-For` 获取用户真实 IP)\n+  proxy_header: \"\"\n+```\n+\n ## 管理员 `admin_users`\n \n 你需要配置管理员账户，这样才能通过「[控制中心](../frontend/sidebar.md)」对站点内容进行管理。"
    },
    {
      "sha": "4d865d20fb1d5d1a203bef8557b7f5954eefc764",
      "filename": "docs/docs/guide/backend/reverse-proxy.md",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/bb218d0ba4f19576ea796fdf4d617af7aca4fde3/docs%2Fdocs%2Fguide%2Fbackend%2Freverse-proxy.md",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/bb218d0ba4f19576ea796fdf4d617af7aca4fde3/docs%2Fdocs%2Fguide%2Fbackend%2Freverse-proxy.md",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/docs%2Fdocs%2Fguide%2Fbackend%2Freverse-proxy.md?ref=bb218d0ba4f19576ea796fdf4d617af7aca4fde3",
      "patch": "@@ -118,3 +118,7 @@ Artalk.init({ server: 'http://artalk.your_domain.com' })\n 打开「反向代理」选项卡，点击「添加反向代理」，「目标 URL」填写 `http://localhost:端口号`（端口号与 Artalk 端口对应），「发送域名」填写 `$host`，如图：\n \n ![](/images/baota-proxy/2.png)\n+\n+## 获取准确的 IP 地址\n+\n+当使用反向代理服务器后，需要配置代理标头才能获取到用户的准确 IP 地址，参考 [IP 属地](../frontend/ip-region.md#获取准确的-ip-地址) 的说明。"
    },
    {
      "sha": "f117910c6741d527a7d054e01e0c1ec20cdd1180",
      "filename": "docs/docs/guide/frontend/ip-region.md",
      "status": "modified",
      "additions": 8,
      "deletions": 2,
      "changes": 10,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/bb218d0ba4f19576ea796fdf4d617af7aca4fde3/docs%2Fdocs%2Fguide%2Ffrontend%2Fip-region.md",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/bb218d0ba4f19576ea796fdf4d617af7aca4fde3/docs%2Fdocs%2Fguide%2Ffrontend%2Fip-region.md",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/docs%2Fdocs%2Fguide%2Ffrontend%2Fip-region.md?ref=bb218d0ba4f19576ea796fdf4d617af7aca4fde3",
      "patch": "@@ -19,8 +19,8 @@ Artalk 内置用户 IP 属地展示功能，并且你可以设置显示的精度\n | 显示精度   | 描述             | 示例       |\n | ---------- | ---------------- | ---------- |\n | `province` | 精确到省（默认） | `四川`     |\n-| `city`     | 精确到城市       | `浙江杭州` |\n-| `country`  | 精确到国家、地区 | `美国`     |\n+| `city`     | 精确到城市       | `四川成都` |\n+| `country`  | 精确到国家、地区 | `中国`     |\n \n 配置文件：\n \n@@ -35,6 +35,12 @@ ip_region:\n   precision: province\n ```\n \n+## 获取准确的 IP 地址\n+\n+如果你正在使用 CDN 或者 Nginx 等可信的反向代理服务器，那么你需要在「设置」-「服务器」选项 -「代理标头名 (`http.proxy_header`)」填写包含用户真实 IP 的请求头字段名，如：`X-Real-IP`（为了安全，该字段默认为空）。修改后，请手动重启 Artalk 服务以生效。\n+\n+否则 Artalk 将无法获取到用户真实 IP 地址（如果使用了 Docker，可能获取到的 IP 始终是 172.17.0.X，这是 Docker 虚拟网卡的 IP）。\n+\n ## 隐私权\n \n Artalk 评论将记录用户的 `IP` 和 `User-Agent` 数据，此类数据有关用户隐私权，请在你的网站隐私政策中声明，并提示用户评论将会收集隐私数据。"
    }
  ]
}
