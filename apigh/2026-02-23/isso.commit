{
  "sha": "df0a0054438eda62f50d7ab86228765762719778",
  "node_id": "C_kwDOAF-mA9oAKGRmMGEwMDU0NDM4ZWRhNjJmNTBkN2FiODYyMjg3NjU3NjI3MTk3Nzg",
  "commit": {
    "author": {
      "name": "Jelmer Vernooĳ",
      "email": "jelmer@jelmer.uk",
      "date": "2026-02-20T23:30:53Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2026-02-20T23:30:53Z"
    },
    "message": "Merge pull request #1085 from isso-comments/migrate-pkg-resources\n\nMigrate pkg resources to importlib",
    "tree": {
      "sha": "a13899acaad5f556b3e24c02ff08a21e649656ba",
      "url": "https://api.github.com/repos/isso-comments/isso/git/trees/a13899acaad5f556b3e24c02ff08a21e649656ba"
    },
    "url": "https://api.github.com/repos/isso-comments/isso/git/commits/df0a0054438eda62f50d7ab86228765762719778",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsFcBAABCAAQBQJpmO6tCRC1aQ7uu5UhlAAAhCIQAKD0/StnaMbuP1eHcX+iYLvi\nnfmRjfWwlqV6HaAzumoW6/aqAJw3i30hH/4jJpDqdOkrjfqVqGo9BonAkkLRLItF\nKYv1AEqE5h/hUIi9lW6mjZ7r4s6FniKIfQGgCvQh8Wmk0TX1sJ1h65Lqvy2bKlXq\ntsHHDPu9SJZd5irTUof4TSkRkU3O875FLOORLXRPqmws6BwQTs2XYPUoaAkSRB3R\naPDUmKyzlCC11zSQ7K5gF+44AKB6gkRqxsBZnoLtsRBgpByjjARUdM5dGOJU7wqh\nAy6X2J/cHjnzDTEKn/cT7qXI/8V+t6H5f+4E/8hhBL8GYRhjT3Ijv9rsREO/oEqi\nBxIj+OXtGupDu2X0sEP8slX3fsDxdO/sXNDNFVX0EgWU8dadGv6pcb2quhxznY5C\nwwckcnBzQ2ACtWLubbEPjyO2+SfnwY0C0z8lFBbpJaigtmW+OLrV+SyXpCwZg2JI\nVCvUB9QsZVOuVBHnvIjORkkulMJBZ1gRdJUWrGoiMfBz5MkSSPMmPOleoYJyfAxf\nXE42KpOZjMrfdd6OpUWsYC1pCbSVTZwx6v7fG6xEWWAUD4wApngFeEfnSzArmEY3\n4O+Yy7zzKGpt0mu2zBqjOs7d6g0oFIBSIE+AN/lnbgQ/fzK7FHz78s16WqcV/wm7\n1o66RjUXr2S5LU7ahaG0\n=Rawk\n-----END PGP SIGNATURE-----\n",
      "payload": "tree a13899acaad5f556b3e24c02ff08a21e649656ba\nparent 09cddc1940c837cbd46559db49459d20f670cd16\nparent 22a92b27985bd1bd02ef69420d64af1be83c8871\nauthor Jelmer Vernooĳ <jelmer@jelmer.uk> 1771630253 +0000\ncommitter GitHub <noreply@github.com> 1771630253 +0000\n\nMerge pull request #1085 from isso-comments/migrate-pkg-resources\n\nMigrate pkg resources to importlib",
      "verified_at": "2026-02-20T23:30:54Z"
    }
  },
  "url": "https://api.github.com/repos/isso-comments/isso/commits/df0a0054438eda62f50d7ab86228765762719778",
  "html_url": "https://github.com/isso-comments/isso/commit/df0a0054438eda62f50d7ab86228765762719778",
  "comments_url": "https://api.github.com/repos/isso-comments/isso/commits/df0a0054438eda62f50d7ab86228765762719778/comments",
  "author": {
    "login": "jelmer",
    "id": 49032,
    "node_id": "MDQ6VXNlcjQ5MDMy",
    "avatar_url": "https://avatars.githubusercontent.com/u/49032?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jelmer",
    "html_url": "https://github.com/jelmer",
    "followers_url": "https://api.github.com/users/jelmer/followers",
    "following_url": "https://api.github.com/users/jelmer/following{/other_user}",
    "gists_url": "https://api.github.com/users/jelmer/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jelmer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jelmer/subscriptions",
    "organizations_url": "https://api.github.com/users/jelmer/orgs",
    "repos_url": "https://api.github.com/users/jelmer/repos",
    "events_url": "https://api.github.com/users/jelmer/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jelmer/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "09cddc1940c837cbd46559db49459d20f670cd16",
      "url": "https://api.github.com/repos/isso-comments/isso/commits/09cddc1940c837cbd46559db49459d20f670cd16",
      "html_url": "https://github.com/isso-comments/isso/commit/09cddc1940c837cbd46559db49459d20f670cd16"
    },
    {
      "sha": "22a92b27985bd1bd02ef69420d64af1be83c8871",
      "url": "https://api.github.com/repos/isso-comments/isso/commits/22a92b27985bd1bd02ef69420d64af1be83c8871",
      "html_url": "https://github.com/isso-comments/isso/commit/22a92b27985bd1bd02ef69420d64af1be83c8871"
    }
  ],
  "stats": {
    "total": 119,
    "additions": 104,
    "deletions": 15
  },
  "files": [
    {
      "sha": "c7b550d68a180936be5b2f8ee88b4ab90d12a766",
      "filename": ".github/workflows/python-tests.yml",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/isso-comments/isso/blob/df0a0054438eda62f50d7ab86228765762719778/.github%2Fworkflows%2Fpython-tests.yml",
      "raw_url": "https://github.com/isso-comments/isso/raw/df0a0054438eda62f50d7ab86228765762719778/.github%2Fworkflows%2Fpython-tests.yml",
      "contents_url": "https://api.github.com/repos/isso-comments/isso/contents/.github%2Fworkflows%2Fpython-tests.yml?ref=df0a0054438eda62f50d7ab86228765762719778",
      "patch": "@@ -11,7 +11,7 @@ jobs:\n     strategy:\n       matrix:\n         os: [ubuntu-latest, macos-latest]\n-        python-version: [3.8, 3.9, \"3.10\", \"3.11\", \"3.12\"]\n+        python-version: [3.9, \"3.10\", \"3.11\", \"3.12\", \"3.13\", \"3.14\"]\n       fail-fast: false\n \n     steps:"
    },
    {
      "sha": "c9ac1ef214f4535438e9eb4088ea11feed62165a",
      "filename": "docs/conf.py",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/isso-comments/isso/blob/df0a0054438eda62f50d7ab86228765762719778/docs%2Fconf.py",
      "raw_url": "https://github.com/isso-comments/isso/raw/df0a0054438eda62f50d7ab86228765762719778/docs%2Fconf.py",
      "contents_url": "https://api.github.com/repos/isso-comments/isso/contents/docs%2Fconf.py?ref=df0a0054438eda62f50d7ab86228765762719778",
      "patch": "@@ -15,7 +15,6 @@\n import sys\n import io\n import re\n-import pkg_resources\n \n from os.path import dirname, join\n # Make `_theme` custom sphinx theme available"
    },
    {
      "sha": "c46564006fcae37345c06bacd1a7b6db818d7c57",
      "filename": "isso/__init__.py",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/isso-comments/isso/blob/df0a0054438eda62f50d7ab86228765762719778/isso%2F__init__.py",
      "raw_url": "https://github.com/isso-comments/isso/raw/df0a0054438eda62f50d7ab86228765762719778/isso%2F__init__.py",
      "contents_url": "https://api.github.com/repos/isso-comments/isso/contents/isso%2F__init__.py?ref=df0a0054438eda62f50d7ab86228765762719778",
      "patch": "@@ -25,8 +25,8 @@\n #\n # Isso – a lightweight Disqus alternative\n \n-import pkg_resources\n-dist = pkg_resources.get_distribution(\"isso\")\n+from importlib.metadata import version\n+__version__ = version(\"isso\")\n \n # check if exectuable is `isso` and gevent is available\n import sys\n@@ -232,7 +232,7 @@ def main():\n     subparser = parser.add_subparsers(help=\"commands\", dest=\"command\")\n \n     parser.add_argument('--version', action='version',\n-                        version='%(prog)s ' + dist.version)\n+                        version='%(prog)s ' + __version__)\n     parser.add_argument(\"-c\", dest=\"conf\", default=\"/etc/isso.cfg\",\n                         metavar=\"/etc/isso.cfg\", help=\"set configuration file\")\n "
    },
    {
      "sha": "8648d850799c7c41cdbc5856304a82d8576261da",
      "filename": "isso/config.py",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/isso-comments/isso/blob/df0a0054438eda62f50d7ab86228765762719778/isso%2Fconfig.py",
      "raw_url": "https://github.com/isso-comments/isso/raw/df0a0054438eda62f50d7ab86228765762719778/isso%2Fconfig.py",
      "contents_url": "https://api.github.com/repos/isso-comments/isso/contents/isso%2Fconfig.py?ref=df0a0054438eda62f50d7ab86228765762719778",
      "patch": "@@ -3,15 +3,15 @@\n import datetime\n import logging\n import os\n-import pkg_resources\n import re\n \n from email.utils import parseaddr, formataddr\n from configparser import ConfigParser, NoOptionError, NoSectionError, DuplicateSectionError\n+from importlib.resources import files\n \n logger = logging.getLogger(\"isso\")\n \n-default_config_file = pkg_resources.resource_filename('isso', 'isso.cfg')\n+default_config_file = str(files('isso').joinpath('isso.cfg'))\n \n \n def timedelta(string):"
    },
    {
      "sha": "9a922b15d31429d41a97bbdb39a6aa885ba299f8",
      "filename": "isso/tests/test_comments.py",
      "status": "modified",
      "additions": 65,
      "deletions": 0,
      "changes": 65,
      "blob_url": "https://github.com/isso-comments/isso/blob/df0a0054438eda62f50d7ab86228765762719778/isso%2Ftests%2Ftest_comments.py",
      "raw_url": "https://github.com/isso-comments/isso/raw/df0a0054438eda62f50d7ab86228765762719778/isso%2Ftests%2Ftest_comments.py",
      "contents_url": "https://api.github.com/repos/isso-comments/isso/contents/isso%2Ftests%2Ftest_comments.py?ref=df0a0054438eda62f50d7ab86228765762719778",
      "patch": "@@ -69,6 +69,22 @@ def testCreate(self):\n         self.assertEqual(rv[\"mode\"], 1)\n         self.assertEqual(rv[\"text\"], '<p>Lorem ipsum ...</p>')\n \n+    def testWebsiteXSSPayloadIsEscaped(self):\n+        \"\"\"Website field with XSS payload must have quotes HTML-escaped.\"\"\"\n+        payload = \"http://x.com/?'onmouseover='alert(document.domain)'x='\"\n+        rv = self.post('/new?uri=%2Fpath%2F',\n+                       data=json.dumps({'text': 'Hello', 'website': payload}))\n+        self.assertEqual(rv.status_code, 201)\n+        rv = loads(rv.data)\n+        # Single quotes must be HTML-escaped so they cannot break out of an\n+        # HTML attribute context (e.g. href='...')\n+        self.assertNotIn(\"'\", rv[\"website\"])\n+        self.assertNotIn('\"', rv[\"website\"])\n+        self.assertEqual(\n+            rv[\"website\"],\n+            \"http://x.com/?&#x27;onmouseover=&#x27;alert(document.domain)&#x27;x=&#x27;\",\n+        )\n+\n     def textCreateWithNonAsciiText(self):\n \n         rv = self.post('/new?uri=%2Fpath%2F',\n@@ -391,6 +407,27 @@ def testUpdate(self):\n         self.assertEqual(rv['website'], 'http://example.com/')\n         self.assertIn('modified', rv)\n \n+    def testUpdateWebsiteXSSPayloadIsEscaped(self):\n+        \"\"\"Website and author XSS payloads via edit endpoint must be HTML-escaped.\"\"\"\n+        self.post('/new?uri=%2Fpath%2F', data=json.dumps({'text': 'Lorem ipsum ...'}))\n+\n+        website_payload = \"http://x.com/?'onmouseover='alert(document.domain)'x='\"\n+        author_payload = \"<script>alert(1)</script>\"\n+        self.put('/id/1', data=json.dumps({\n+            'text': 'Hello World',\n+            'author': author_payload,\n+            'website': website_payload,\n+        }))\n+\n+        rv = loads(self.get('/id/1?plain=1').data)\n+        self.assertNotIn(\"'\", rv[\"website\"])\n+        self.assertEqual(\n+            rv[\"website\"],\n+            \"http://x.com/?&#x27;onmouseover=&#x27;alert(document.domain)&#x27;x=&#x27;\",\n+        )\n+        self.assertNotIn(\"<script>\", rv[\"author\"])\n+        self.assertEqual(rv[\"author\"], \"&lt;script&gt;alert(1)&lt;/script&gt;\")\n+\n     def testUpdateForbidden(self):\n \n         self.post('/new?uri=test', data=json.dumps({'text': 'Hello world!'}))\n@@ -860,6 +897,34 @@ def testModerateComment(self):\n         # Comment should no longer exist\n         self.assertEqual(self.app.db.comments.get(id_), None)\n \n+    def testModerateEditXSSPayloadIsEscaped(self):\n+        \"\"\"XSS payloads in author/website via moderate edit endpoint must be HTML-escaped.\"\"\"\n+        id_ = 1\n+        signed = self.app.sign(id_)\n+\n+        self.client.post('/new?uri=/moderated', data=json.dumps({\"text\": \"...\"}))\n+\n+        website_payload = \"http://x.com/?'onmouseover='alert(document.domain)'x='\"\n+        author_payload = \"<script>alert(1)</script>\"\n+        rv = self.client.post(\n+            '/id/%d/edit/%s' % (id_, signed),\n+            data=json.dumps({\n+                \"text\": \"new text\",\n+                \"author\": author_payload,\n+                \"website\": website_payload,\n+            }),\n+        )\n+        self.assertEqual(rv.status_code, 200)\n+\n+        stored = self.app.db.comments.get(id_)\n+        self.assertNotIn(\"'\", stored[\"website\"])\n+        self.assertEqual(\n+            stored[\"website\"],\n+            \"http://x.com/?&#x27;onmouseover=&#x27;alert(document.domain)&#x27;x=&#x27;\",\n+        )\n+        self.assertNotIn(\"<script>\", stored[\"author\"])\n+        self.assertEqual(stored[\"author\"], \"&lt;script&gt;alert(1)&lt;/script&gt;\")\n+\n \n class TestUnsubscribe(unittest.TestCase):\n "
    },
    {
      "sha": "404f950b7e8e32faa4a56193da87e8edc92ef009",
      "filename": "isso/utils/http.py",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/isso-comments/isso/blob/df0a0054438eda62f50d7ab86228765762719778/isso%2Futils%2Fhttp.py",
      "raw_url": "https://github.com/isso-comments/isso/raw/df0a0054438eda62f50d7ab86228765762719778/isso%2Futils%2Fhttp.py",
      "contents_url": "https://api.github.com/repos/isso-comments/isso/contents/isso%2Futils%2Fhttp.py?ref=df0a0054438eda62f50d7ab86228765762719778",
      "patch": "@@ -6,7 +6,7 @@\n \n from urllib.parse import urlparse\n \n-from isso import dist\n+from isso import __version__\n from isso.wsgi import urlsplit\n \n MAX_RETRY_COUNT = 3\n@@ -24,7 +24,7 @@ class curl(object):\n     \"\"\"\n \n     headers = {\n-        \"User-Agent\": \"Isso/{0} (+https://isso-comments.de)\".format(dist.version)\n+        \"User-Agent\": \"Isso/{0} (+https://isso-comments.de)\".format(__version__)\n     }\n \n     def __init__(self, method, host, path, timeout=3):"
    },
    {
      "sha": "c85fc3bc2f729f94c4f3e6260630b898c1b94e35",
      "filename": "isso/views/__init__.py",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/isso-comments/isso/blob/df0a0054438eda62f50d7ab86228765762719778/isso%2Fviews%2F__init__.py",
      "raw_url": "https://github.com/isso-comments/isso/raw/df0a0054438eda62f50d7ab86228765762719778/isso%2Fviews%2F__init__.py",
      "contents_url": "https://api.github.com/repos/isso-comments/isso/contents/isso%2Fviews%2F__init__.py?ref=df0a0054438eda62f50d7ab86228765762719778",
      "patch": "@@ -1,7 +1,7 @@\n # -*- encoding: utf-8 -*-\n \n-import pkg_resources\n-dist = pkg_resources.get_distribution(\"isso\")\n+from importlib.metadata import version\n+__version__ = version(\"isso\")\n \n import json\n \n@@ -81,7 +81,7 @@ def __init__(self, isso):\n     def show(self, environ, request):\n \n         rv = {\n-            \"version\": dist.version,\n+            \"version\": __version__,\n             \"host\": str(local(\"host\")),\n             \"origin\": str(local(\"origin\")),\n             \"moderation\": self.moderation,"
    },
    {
      "sha": "2c86e065a5a3d3cebec44f207d34e45a01c31be0",
      "filename": "isso/views/comments.py",
      "status": "modified",
      "additions": 28,
      "deletions": 3,
      "changes": 31,
      "blob_url": "https://github.com/isso-comments/isso/blob/df0a0054438eda62f50d7ab86228765762719778/isso%2Fviews%2Fcomments.py",
      "raw_url": "https://github.com/isso-comments/isso/raw/df0a0054438eda62f50d7ab86228765762719778/isso%2Fviews%2Fcomments.py",
      "contents_url": "https://api.github.com/repos/isso-comments/isso/contents/isso%2Fviews%2Fcomments.py?ref=df0a0054438eda62f50d7ab86228765762719778",
      "patch": "@@ -5,9 +5,9 @@\n import time\n import functools\n import json  # json.dumps to put URL in <script>\n-import pkg_resources\n \n from configparser import NoOptionError\n+from importlib.resources import files\n from datetime import datetime, timedelta\n from html import escape\n from io import BytesIO as StringIO\n@@ -335,10 +335,13 @@ def new(self, environ, request, uri):\n         if not valid:\n             return BadRequest(reason)\n \n-        for field in (\"author\", \"email\", \"website\"):\n+        for field in (\"author\", \"email\"):\n             if data.get(field) is not None:\n                 data[field] = escape(data[field], quote=False)\n \n+        if data.get(\"website\") is not None:\n+            data[\"website\"] = escape(data[\"website\"], quote=True)\n+\n         if data.get(\"website\"):\n             data[\"website\"] = normalize(data[\"website\"])\n \n@@ -548,6 +551,13 @@ def edit(self, environ, request, id):\n         if not valid:\n             return BadRequest(reason)\n \n+        for field in (\"author\",):\n+            if data.get(field) is not None:\n+                data[field] = escape(data[field], quote=False)\n+\n+        if data.get(\"website\") is not None:\n+            data[\"website\"] = escape(data[\"website\"], quote=True)\n+\n         data['modified'] = time.time()\n \n         with self.isso.lock:\n@@ -794,6 +804,21 @@ def moderate(self, environ, request, id, action, key):\n             return Response(\"Comment has been activated\", 200)\n         elif action == \"edit\":\n             data = request.json\n+\n+            for key in set(data.keys()) - set([\"text\", \"author\", \"website\"]):\n+                data.pop(key)\n+\n+            valid, reason = API.verify(data)\n+            if not valid:\n+                return BadRequest(reason)\n+\n+            for field in (\"author\",):\n+                if data.get(field) is not None:\n+                    data[field] = escape(data[field], quote=False)\n+\n+            if data.get(\"website\") is not None:\n+                data[\"website\"] = escape(data[\"website\"], quote=True)\n+\n             with self.isso.lock:\n                 rv = self.comments.update(id, data)\n             for key in set(rv.keys()) - API.FIELDS:\n@@ -1391,7 +1416,7 @@ def config(self, environment, request):\n         </body>\n     \"\"\"\n     def demo(self, env, req):\n-        index = pkg_resources.resource_filename('isso', 'demo/index.html')\n+        index = str(files('isso').joinpath('demo/index.html'))\n         return send_from_directory(os_path.dirname(index), 'index.html', env)\n \n     \"\"\""
    }
  ]
}
