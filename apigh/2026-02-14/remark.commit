{
  "sha": "e3b0d636483dc14a725aef34738701a0cba334f8",
  "node_id": "C_kwDOBtgov9oAKGUzYjBkNjM2NDgzZGMxNGE3MjVhZWYzNDczODcwMWEwY2JhMzM0Zjg",
  "commit": {
    "author": {
      "name": "Umputun",
      "email": "umputun@gmail.com",
      "date": "2026-02-11T04:53:31Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2026-02-11T04:53:31Z"
    },
    "message": "Merge pull request #1999 from umputun/configurable-microsoft-tenant\n\nfeat: make Microsoft Entra ID tenant configurable",
    "tree": {
      "sha": "b4c4f51a9d2518cd639279f62294a49824ea2ead",
      "url": "https://api.github.com/repos/umputun/remark42/git/trees/b4c4f51a9d2518cd639279f62294a49824ea2ead"
    },
    "url": "https://api.github.com/repos/umputun/remark42/git/commits/e3b0d636483dc14a725aef34738701a0cba334f8",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsFcBAABCAAQBQJpjAtLCRC1aQ7uu5UhlAAAiMEQAKQ5ZyS/zH3MgbCoUBO/0Je8\nUYPyRLiqGsbWFYP9vRJwQIW43HhFbza3Flk/Hy2RwyckoOB7klRRvxjo0iPU9tev\nnZHels2npfOqmq3ywOeNr3EyQNihJKbHA1CZnt1k8pTgqOrMmqYkgyElPmdu4TPr\np899OH2JI9ks4VWYMRhZMk1cHyncGcJzlm8C2EBuVhp2lB0tLfNkHLnNekUin8Jm\nade1hXzqQJw6JylL4FMnBYCnYMvvW/ppobC24eGNc+BhprH3QCAhC3GETHLHZ4/c\nsCzodD22gaUl3Mm9551MhGePvdA2qFz4bS3TLYKfXVJEzxVoACrIUzQHdR+Q7/Ag\nF+alSR8zgrvq/zcnfcESIJGWJNtINRLAS8FrbgdKRGvON1mKQsj+miduJnTcW/Hf\nAajBCEtYzWQ7xt4XiMpftizaHvDgX0DUReKSI12cGnR259eb6689y5vWQfubPtgp\nSE+2Ghe++0W4x/ctjkMcnB3yvrlUlPmp5sYt/93VcbNpZEP9Edz7hHmOSeM3RotC\nrp2bTu69Z9YC8w9CIcz6sAUbguWzpZ0CdnkAmkHLA5h8lsyLpxzXg4UpyXJphday\n6InIWszIpKSCXlGCbGkBwAdwg18GJPaFFYHBZULPEKcZRZY3WVNQL6IBeJxRbmcH\nZNPkoemgwMxfPKcM888+\n=5kVU\n-----END PGP SIGNATURE-----\n",
      "payload": "tree b4c4f51a9d2518cd639279f62294a49824ea2ead\nparent b38d91cb0f40a6429b61578854d2801ec34170df\nparent 31e20fc26d778d5285a827395a225ac1eae3e8ab\nauthor Umputun <umputun@gmail.com> 1770785611 -0600\ncommitter GitHub <noreply@github.com> 1770785611 -0600\n\nMerge pull request #1999 from umputun/configurable-microsoft-tenant\n\nfeat: make Microsoft Entra ID tenant configurable",
      "verified_at": "2026-02-11T04:53:32Z"
    }
  },
  "url": "https://api.github.com/repos/umputun/remark42/commits/e3b0d636483dc14a725aef34738701a0cba334f8",
  "html_url": "https://github.com/umputun/remark42/commit/e3b0d636483dc14a725aef34738701a0cba334f8",
  "comments_url": "https://api.github.com/repos/umputun/remark42/commits/e3b0d636483dc14a725aef34738701a0cba334f8/comments",
  "author": {
    "login": "umputun",
    "id": 535880,
    "node_id": "MDQ6VXNlcjUzNTg4MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/535880?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/umputun",
    "html_url": "https://github.com/umputun",
    "followers_url": "https://api.github.com/users/umputun/followers",
    "following_url": "https://api.github.com/users/umputun/following{/other_user}",
    "gists_url": "https://api.github.com/users/umputun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/umputun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/umputun/subscriptions",
    "organizations_url": "https://api.github.com/users/umputun/orgs",
    "repos_url": "https://api.github.com/users/umputun/repos",
    "events_url": "https://api.github.com/users/umputun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/umputun/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b38d91cb0f40a6429b61578854d2801ec34170df",
      "url": "https://api.github.com/repos/umputun/remark42/commits/b38d91cb0f40a6429b61578854d2801ec34170df",
      "html_url": "https://github.com/umputun/remark42/commit/b38d91cb0f40a6429b61578854d2801ec34170df"
    },
    {
      "sha": "31e20fc26d778d5285a827395a225ac1eae3e8ab",
      "url": "https://api.github.com/repos/umputun/remark42/commits/31e20fc26d778d5285a827395a225ac1eae3e8ab",
      "html_url": "https://github.com/umputun/remark42/commit/31e20fc26d778d5285a827395a225ac1eae3e8ab"
    }
  ],
  "stats": {
    "total": 99,
    "additions": 82,
    "deletions": 17
  },
  "files": [
    {
      "sha": "32074f3e499cf1ca7dba5bbd4f0ae9c01a3fb7d1",
      "filename": "backend/app/cmd/server.go",
      "status": "modified",
      "additions": 9,
      "deletions": 2,
      "changes": 11,
      "blob_url": "https://github.com/umputun/remark42/blob/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fapp%2Fcmd%2Fserver.go",
      "raw_url": "https://github.com/umputun/remark42/raw/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fapp%2Fcmd%2Fserver.go",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend%2Fapp%2Fcmd%2Fserver.go?ref=e3b0d636483dc14a725aef34738701a0cba334f8",
      "patch": "@@ -103,7 +103,7 @@ type ServerCommand struct {\n \t\tGoogle    AuthGroup  `group:\"google\" namespace:\"google\" env-namespace:\"GOOGLE\" description:\"Google OAuth\"`\n \t\tGithub    AuthGroup  `group:\"github\" namespace:\"github\" env-namespace:\"GITHUB\" description:\"Github OAuth\"`\n \t\tFacebook  AuthGroup  `group:\"facebook\" namespace:\"facebook\" env-namespace:\"FACEBOOK\" description:\"Facebook OAuth\"`\n-\t\tMicrosoft AuthGroup  `group:\"microsoft\" namespace:\"microsoft\" env-namespace:\"MICROSOFT\" description:\"Microsoft OAuth\"`\n+\t\tMicrosoft MicrosoftAuthGroup `group:\"microsoft\" namespace:\"microsoft\" env-namespace:\"MICROSOFT\" description:\"Microsoft OAuth\"`\n \t\tYandex    AuthGroup  `group:\"yandex\" namespace:\"yandex\" env-namespace:\"YANDEX\" description:\"Yandex OAuth\"`\n \t\tTwitter   AuthGroup  `group:\"twitter\" namespace:\"twitter\" env-namespace:\"TWITTER\" description:\"[deprecated, doesn't work] Twitter OAuth\"`\n \t\tPatreon   AuthGroup  `group:\"patreon\" namespace:\"patreon\" env-namespace:\"PATREON\" description:\"Patreon OAuth\"`\n@@ -152,6 +152,13 @@ type AuthGroup struct {\n \tCSEC string `long:\"csec\" env:\"CSEC\" description:\"OAuth client secret\"`\n }\n \n+// MicrosoftAuthGroup defines options group for Microsoft auth params\n+type MicrosoftAuthGroup struct {\n+\tCID    string `long:\"cid\" env:\"CID\" description:\"OAuth client ID\"`\n+\tCSEC   string `long:\"csec\" env:\"CSEC\" description:\"OAuth client secret\"`\n+\tTenant string `long:\"tenant\" env:\"TENANT\" description:\"Azure AD tenant ID, domain, or 'common' (default)\" default:\"common\"`\n+}\n+\n // StoreGroup defines options group for store params\n type StoreGroup struct {\n \tType string `long:\"type\" env:\"TYPE\" description:\"type of storage\" choice:\"bolt\" choice:\"rpc\" default:\"bolt\"` // nolint\n@@ -939,7 +946,7 @@ func (s *ServerCommand) addAuthProviders(authenticator *auth.Service) error {\n \t\tprovidersCount++\n \t}\n \tif s.Auth.Microsoft.CID != \"\" && s.Auth.Microsoft.CSEC != \"\" {\n-\t\tauthenticator.AddProvider(\"microsoft\", s.Auth.Microsoft.CID, s.Auth.Microsoft.CSEC)\n+\t\tauthenticator.AddMicrosoftProvider(s.Auth.Microsoft.CID, s.Auth.Microsoft.CSEC, s.Auth.Microsoft.Tenant)\n \t\tprovidersCount++\n \t}\n \tif s.Auth.Yandex.CID != \"\" && s.Auth.Yandex.CSEC != \"\" {"
    },
    {
      "sha": "6c0e4c75a0952bb28653cc1c9e2fefc00a6c6b10",
      "filename": "backend/go.mod",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/umputun/remark42/blob/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fgo.mod",
      "raw_url": "https://github.com/umputun/remark42/raw/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fgo.mod",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend%2Fgo.mod?ref=e3b0d636483dc14a725aef34738701a0cba334f8",
      "patch": "@@ -9,7 +9,7 @@ require (\n \tgithub.com/didip/tollbooth/v8 v8.0.1\n \tgithub.com/go-chi/chi/v5 v5.2.3\n \tgithub.com/go-chi/cors v1.2.2\n-\tgithub.com/go-pkgz/auth/v2 v2.1.1\n+\tgithub.com/go-pkgz/auth/v2 v2.1.2-0.20260211003156-fbba7f2baa6b\n \tgithub.com/go-pkgz/jrpc v0.4.0\n \tgithub.com/go-pkgz/lcw/v2 v2.0.0\n \tgithub.com/go-pkgz/lgr v0.12.1"
    },
    {
      "sha": "be793b64ea3abd4909105d291124bc1cc9525d27",
      "filename": "backend/go.sum",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/umputun/remark42/blob/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fgo.sum",
      "raw_url": "https://github.com/umputun/remark42/raw/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fgo.sum",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend%2Fgo.sum?ref=e3b0d636483dc14a725aef34738701a0cba334f8",
      "patch": "@@ -50,6 +50,12 @@ github.com/go-oauth2/oauth2/v4 v4.5.4 h1:YjI0tmGW8oxVhn9QSBIxlr641QugWrJY5UWa6Xm\n github.com/go-oauth2/oauth2/v4 v4.5.4/go.mod h1:BXiOY+QZtZy2ewbsGk2B5P8TWmtz/Rf7ES5ZttQFxfQ=\n github.com/go-pkgz/auth/v2 v2.1.1 h1:CBH3Z6ovLT51Nx9TkBcu2L8Dd/xwL6CgJcgqUnC2isQ=\n github.com/go-pkgz/auth/v2 v2.1.1/go.mod h1:9LwzESczjMavmXNZo1XhYpfYdKWtoCbXt/ZIi0GTvF0=\n+github.com/go-pkgz/auth/v2 v2.1.2-0.20260119213210-5ff800f4c064 h1:+7XirxGV7RV0VzStWbyP6c0edbfaCXB69JeZh6uVpE0=\n+github.com/go-pkgz/auth/v2 v2.1.2-0.20260119213210-5ff800f4c064/go.mod h1:9LwzESczjMavmXNZo1XhYpfYdKWtoCbXt/ZIi0GTvF0=\n+github.com/go-pkgz/auth/v2 v2.1.2-0.20260210234152-7e1ed2cedf71 h1:FxzoRgUemfWKBt0iw9J9Qck5nHB6bNlhmUJneMNL/C8=\n+github.com/go-pkgz/auth/v2 v2.1.2-0.20260210234152-7e1ed2cedf71/go.mod h1:9LwzESczjMavmXNZo1XhYpfYdKWtoCbXt/ZIi0GTvF0=\n+github.com/go-pkgz/auth/v2 v2.1.2-0.20260211003156-fbba7f2baa6b h1:N8iS/o/LgbSL4NLabOuLgfmROjtMLW2Qc3EsMmdYNGs=\n+github.com/go-pkgz/auth/v2 v2.1.2-0.20260211003156-fbba7f2baa6b/go.mod h1:9LwzESczjMavmXNZo1XhYpfYdKWtoCbXt/ZIi0GTvF0=\n github.com/go-pkgz/email v0.6.0 h1:snZnXldjeF4PgKSjnx9Fa25mtOgFpAOEeWvnQvrxjLE=\n github.com/go-pkgz/email v0.6.0/go.mod h1:+wgi4x7S33IuCzfcCM5euN0GwQG6XvO/PBLxrNffYLI=\n github.com/go-pkgz/expirable-cache/v3 v3.1.0 h1:s05P851/O6QJ6Mc+7o2bh9aGtD3romB1SxDTXifdoqc="
    },
    {
      "sha": "b4ffad3afed1ecf644e3423df5c0834f1de8862d",
      "filename": "backend/vendor/github.com/go-pkgz/auth/v2/auth.go",
      "status": "modified",
      "additions": 27,
      "deletions": 7,
      "changes": 34,
      "blob_url": "https://github.com/umputun/remark42/blob/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fvendor%2Fgithub.com%2Fgo-pkgz%2Fauth%2Fv2%2Fauth.go",
      "raw_url": "https://github.com/umputun/remark42/raw/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fvendor%2Fgithub.com%2Fgo-pkgz%2Fauth%2Fv2%2Fauth.go",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend%2Fvendor%2Fgithub.com%2Fgo-pkgz%2Fauth%2Fv2%2Fauth.go?ref=e3b0d636483dc14a725aef34738701a0cba334f8",
      "patch": "@@ -68,17 +68,17 @@ type Opts struct {\n \tAvatarRoutePath   string       // avatar routing prefix, i.e. \"/api/v1/avatar\", default `/avatar`\n \tUseGravatar       bool         // for email based auth (verified provider) use gravatar service\n \n-\tAdminPasswd      string                   // if presented, allows basic auth with user admin and given password\n-\tBasicAuthChecker middleware.BasicAuthFunc // user custom checker for basic auth, if one defined then \"AdminPasswd\" will ignored\n-\tAudienceReader   token.Audience           // list of allowed aud values, default (empty) allows any\n-\tAudSecrets       bool                     // allow multiple secrets (secret per aud)\n-\tLogger           logger.L                 // logger interface, default is no logging at all\n-\tRefreshCache     middleware.RefreshCache  // optional cache to keep refreshed tokens\n+\tAdminPasswd      string                      // if presented, allows basic auth with user admin and given password\n+\tBasicAuthChecker middleware.BasicAuthFunc    // user custom checker for basic auth, if one defined then \"AdminPasswd\" will ignored\n+\tAudienceReader   token.Audience              // list of allowed aud values, default (empty) allows any\n+\tAudSecrets       bool                        // allow multiple secrets (secret per aud)\n+\tLogger           logger.L                    // logger interface, default is no logging at all\n+\tRefreshCache     middleware.RefreshCache     // optional cache to keep refreshed tokens\n+\tErrorHandler     middleware.ErrorHandlerFunc // custom error handler for auth failures\n }\n \n // NewService initializes everything\n func NewService(opts Opts) (res *Service) {\n-\n \tres = &Service{\n \t\topts:   opts,\n \t\tlogger: opts.Logger,\n@@ -87,6 +87,7 @@ func NewService(opts Opts) (res *Service) {\n \t\t\tAdminPasswd:      opts.AdminPasswd,\n \t\t\tBasicAuthChecker: opts.BasicAuthChecker,\n \t\t\tRefreshCache:     opts.RefreshCache,\n+\t\t\tErrorHandler:     opts.ErrorHandler,\n \t\t},\n \t\tissuer:      opts.Issuer,\n \t\tuseGravatar: opts.UseGravatar,\n@@ -320,6 +321,25 @@ func (s *Service) AddProvider(name, cid, csecret string) {\n \ts.addProviderByName(name, p)\n }\n \n+// AddMicrosoftProvider adds microsoft provider with a configurable tenant.\n+// If tenant is empty, \"common\" is used. For single-tenant Entra ID apps,\n+// pass the directory (tenant) ID or domain name.\n+// For advanced configuration (e.g., UserAttributes), construct provider.Params directly.\n+func (s *Service) AddMicrosoftProvider(cid, csecret, tenant string) {\n+\tp := provider.Params{\n+\t\tURL:             s.opts.URL,\n+\t\tJwtService:      s.jwtService,\n+\t\tIssuer:          s.issuer,\n+\t\tAvatarSaver:     s.avatarProxy,\n+\t\tCid:             cid,\n+\t\tCsecret:         csecret,\n+\t\tL:               s.logger,\n+\t\tUserAttributes:  map[string]string{},\n+\t\tMicrosoftTenant: tenant,\n+\t}\n+\ts.addProvider(provider.NewMicrosoft(p))\n+}\n+\n // AddDevProvider with a custom host and port\n func (s *Service) AddDevProvider(host string, port int) {\n \tp := provider.Params{"
    },
    {
      "sha": "bb375495d98428ada81525c9db6f43da77490bb5",
      "filename": "backend/vendor/github.com/go-pkgz/auth/v2/middleware/auth.go",
      "status": "modified",
      "additions": 28,
      "deletions": 5,
      "changes": 33,
      "blob_url": "https://github.com/umputun/remark42/blob/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fvendor%2Fgithub.com%2Fgo-pkgz%2Fauth%2Fv2%2Fmiddleware%2Fauth.go",
      "raw_url": "https://github.com/umputun/remark42/raw/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fvendor%2Fgithub.com%2Fgo-pkgz%2Fauth%2Fv2%2Fmiddleware%2Fauth.go",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend%2Fvendor%2Fgithub.com%2Fgo-pkgz%2Fauth%2Fv2%2Fmiddleware%2Fauth.go?ref=e3b0d636483dc14a725aef34738701a0cba334f8",
      "patch": "@@ -24,6 +24,7 @@ type Authenticator struct {\n \tAdminPasswd      string\n \tBasicAuthChecker BasicAuthFunc\n \tRefreshCache     RefreshCache\n+\tErrorHandler     ErrorHandlerFunc // custom error handler for auth failures\n }\n \n // RefreshCache defines interface storing and retrieving refreshed tokens\n@@ -45,6 +46,13 @@ type TokenService interface {\n // The second return parameter `User` need for add user claims into context of request.\n type BasicAuthFunc func(user, passwd string) (ok bool, userInfo token.User, err error)\n \n+// ErrorHandlerFunc type is an adapter to allow custom error handling for auth failures.\n+// It receives the suggested HTTP status code and the error that caused the auth failure.\n+// The handler can respond with custom status codes, HTML pages, redirects, or JSON responses.\n+// Status codes are typically http.StatusUnauthorized (401) for auth failures\n+// or http.StatusForbidden (403) for permission denied.\n+type ErrorHandlerFunc func(w http.ResponseWriter, r *http.Request, statusCode int, err error)\n+\n // adminUser sets claims for an optional basic auth\n var adminUser = token.User{\n \tID:   \"admin\",\n@@ -73,7 +81,7 @@ func (a *Authenticator) auth(reqAuth bool) func(http.Handler) http.Handler {\n \t\t\treturn\n \t\t}\n \t\ta.Logf(\"[DEBUG] auth failed, %v\", err)\n-\t\thttp.Error(w, \"Unauthorized\", http.StatusUnauthorized)\n+\t\ta.errResponse(w, r, http.StatusUnauthorized, err)\n \t}\n \n \tf := func(h http.Handler) http.Handler {\n@@ -208,12 +216,12 @@ func (a *Authenticator) AdminOnly(next http.Handler) http.Handler {\n \tfn := func(w http.ResponseWriter, r *http.Request) {\n \t\tuser, err := token.GetUserInfo(r)\n \t\tif err != nil {\n-\t\t\thttp.Error(w, \"Unauthorized\", http.StatusUnauthorized)\n+\t\t\ta.errResponse(w, r, http.StatusUnauthorized, err)\n \t\t\treturn\n \t\t}\n \n \t\tif !user.IsAdmin() {\n-\t\t\thttp.Error(w, \"Access denied\", http.StatusForbidden)\n+\t\t\ta.errResponse(w, r, http.StatusForbidden, fmt.Errorf(\"user %s is not admin\", user.Name))\n \t\t\treturn\n \t\t}\n \t\tnext.ServeHTTP(w, r)\n@@ -242,6 +250,21 @@ func (a *Authenticator) basicAdminUser(r *http.Request) bool {\n \treturn true\n }\n \n+// errResponse calls ErrorHandler if set, otherwise returns default http error\n+func (a *Authenticator) errResponse(w http.ResponseWriter, r *http.Request, code int, err error) {\n+\tif a.ErrorHandler != nil {\n+\t\ta.ErrorHandler(w, r, code, err)\n+\t\treturn\n+\t}\n+\t// preserve original error messages for backward compatibility\n+\tswitch code {\n+\tcase http.StatusForbidden:\n+\t\thttp.Error(w, \"Access denied\", code)\n+\tdefault:\n+\t\thttp.Error(w, \"Unauthorized\", code)\n+\t}\n+}\n+\n // RBAC middleware allows role based control for routes\n // this handler internally wrapped with auth(true) to avoid situation if RBAC defined without prior Auth\n func (a *Authenticator) RBAC(roles ...string) func(http.Handler) http.Handler {\n@@ -250,7 +273,7 @@ func (a *Authenticator) RBAC(roles ...string) func(http.Handler) http.Handler {\n \t\tfn := func(w http.ResponseWriter, r *http.Request) {\n \t\t\tuser, err := token.GetUserInfo(r)\n \t\t\tif err != nil {\n-\t\t\t\thttp.Error(w, \"Unauthorized\", http.StatusUnauthorized)\n+\t\t\t\ta.errResponse(w, r, http.StatusUnauthorized, err)\n \t\t\t\treturn\n \t\t\t}\n \n@@ -262,7 +285,7 @@ func (a *Authenticator) RBAC(roles ...string) func(http.Handler) http.Handler {\n \t\t\t\t}\n \t\t\t}\n \t\t\tif !matched {\n-\t\t\t\thttp.Error(w, \"Access denied\", http.StatusForbidden)\n+\t\t\t\ta.errResponse(w, r, http.StatusForbidden, fmt.Errorf(\"user %s role %s not in allowed roles\", user.Name, user.Role))\n \t\t\t\treturn\n \t\t\t}\n \t\t\th.ServeHTTP(w, r)"
    },
    {
      "sha": "e1ee0cfcffe74c3f8dfd569c5011adb1557f951a",
      "filename": "backend/vendor/github.com/go-pkgz/auth/v2/provider/oauth2.go",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/umputun/remark42/blob/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fvendor%2Fgithub.com%2Fgo-pkgz%2Fauth%2Fv2%2Fprovider%2Foauth2.go",
      "raw_url": "https://github.com/umputun/remark42/raw/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fvendor%2Fgithub.com%2Fgo-pkgz%2Fauth%2Fv2%2Fprovider%2Foauth2.go",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend%2Fvendor%2Fgithub.com%2Fgo-pkgz%2Fauth%2Fv2%2Fprovider%2Foauth2.go?ref=e3b0d636483dc14a725aef34738701a0cba334f8",
      "patch": "@@ -44,6 +44,8 @@ type Params struct {\n \n \tPort int    // relevant for providers supporting port customization, for example dev oauth2\n \tHost string // relevant for providers supporting host customization, for example dev oauth2\n+\n+\tMicrosoftTenant string // tenant for microsoft provider, default \"common\"\n }\n \n // UserData is type for user information returned from oauth2 providers /info API method"
    },
    {
      "sha": "5f4b7bf190f651ac52cfdfa178b38a59a51b7c0f",
      "filename": "backend/vendor/github.com/go-pkgz/auth/v2/provider/providers.go",
      "status": "modified",
      "additions": 6,
      "deletions": 1,
      "changes": 7,
      "blob_url": "https://github.com/umputun/remark42/blob/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fvendor%2Fgithub.com%2Fgo-pkgz%2Fauth%2Fv2%2Fprovider%2Fproviders.go",
      "raw_url": "https://github.com/umputun/remark42/raw/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fvendor%2Fgithub.com%2Fgo-pkgz%2Fauth%2Fv2%2Fprovider%2Fproviders.go",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend%2Fvendor%2Fgithub.com%2Fgo-pkgz%2Fauth%2Fv2%2Fprovider%2Fproviders.go?ref=e3b0d636483dc14a725aef34738701a0cba334f8",
      "patch": "@@ -5,6 +5,7 @@ import (\n \t\"crypto/sha1\" //nolint\n \t\"encoding/json\"\n \t\"fmt\"\n+\t\"strings\"\n \n \t\"github.com/dghubble/oauth1\"\n \t\"github.com/dghubble/oauth1/twitter\"\n@@ -192,9 +193,13 @@ func NewBattlenet(p Params) Oauth2Handler {\n \n // NewMicrosoft makes microsoft azure oauth2 provider\n func NewMicrosoft(p Params) Oauth2Handler {\n+\ttenant := p.MicrosoftTenant\n+\tif tenant == \"\" || strings.ContainsAny(tenant, \"/?# \\t\\n\\r\") || strings.Contains(tenant, \"..\") {\n+\t\ttenant = \"common\"\n+\t}\n \treturn initOauth2Handler(p, Oauth2Handler{\n \t\tname:     \"microsoft\",\n-\t\tendpoint: microsoft.AzureADEndpoint(\"common\"),\n+\t\tendpoint: microsoft.AzureADEndpoint(tenant),\n \t\tscopes:   []string{\"User.Read\"},\n \t\tinfoURL:  \"https://graph.microsoft.com/v1.0/me\",\n \t\t// non-beta doesn't provide photo for consumers yet"
    },
    {
      "sha": "b0b22626b8e31b551bd297026795728cdd4538de",
      "filename": "backend/vendor/modules.txt",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/umputun/remark42/blob/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fvendor%2Fmodules.txt",
      "raw_url": "https://github.com/umputun/remark42/raw/e3b0d636483dc14a725aef34738701a0cba334f8/backend%2Fvendor%2Fmodules.txt",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend%2Fvendor%2Fmodules.txt?ref=e3b0d636483dc14a725aef34738701a0cba334f8",
      "patch": "@@ -56,7 +56,7 @@ github.com/go-chi/cors\n github.com/go-oauth2/oauth2/v4\n github.com/go-oauth2/oauth2/v4/errors\n github.com/go-oauth2/oauth2/v4/server\n-# github.com/go-pkgz/auth/v2 v2.1.1\n+# github.com/go-pkgz/auth/v2 v2.1.2-0.20260211003156-fbba7f2baa6b\n ## explicit; go 1.24.0\n github.com/go-pkgz/auth/v2\n github.com/go-pkgz/auth/v2/avatar"
    },
    {
      "sha": "1557b0384c4a39b91afb3963f83ba635f72d1547",
      "filename": "site/src/docs/configuration/authorization/index.md",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/umputun/remark42/blob/e3b0d636483dc14a725aef34738701a0cba334f8/site%2Fsrc%2Fdocs%2Fconfiguration%2Fauthorization%2Findex.md",
      "raw_url": "https://github.com/umputun/remark42/raw/e3b0d636483dc14a725aef34738701a0cba334f8/site%2Fsrc%2Fdocs%2Fconfiguration%2Fauthorization%2Findex.md",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/site%2Fsrc%2Fdocs%2Fconfiguration%2Fauthorization%2Findex.md?ref=e3b0d636483dc14a725aef34738701a0cba334f8",
      "patch": "@@ -82,6 +82,7 @@ _instructions for Google OAuth2 setup borrowed from [oauth2_proxy](https://githu\n 3. In **\"Overview\"** take note of the **Application (client) ID** (`AUTH_MICROSOFT_CID`)\n 4. Choose the new project from the top right project dropdown (only if another project is selected)\n 5. Select **\"Certificates & secrets\"** and click on **\"+ New Client Secret\"** (`AUTH_MICROSOFT_CSEC`)\n+6. For single-tenant Entra ID applications, set `AUTH_MICROSOFT_TENANT` to your tenant ID or domain name. The default value is `common`, which works for multi-tenant applications.\n \n ### Yandex\n "
    },
    {
      "sha": "f6124cf8c1cd3e7f4ca69923b8125f81266892e2",
      "filename": "site/src/docs/configuration/parameters/index.md",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/umputun/remark42/blob/e3b0d636483dc14a725aef34738701a0cba334f8/site%2Fsrc%2Fdocs%2Fconfiguration%2Fparameters%2Findex.md",
      "raw_url": "https://github.com/umputun/remark42/raw/e3b0d636483dc14a725aef34738701a0cba334f8/site%2Fsrc%2Fdocs%2Fconfiguration%2Fparameters%2Findex.md",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/site%2Fsrc%2Fdocs%2Fconfiguration%2Fparameters%2Findex.md?ref=e3b0d636483dc14a725aef34738701a0cba334f8",
      "patch": "@@ -91,6 +91,7 @@ services:\n | auth.facebook.csec             | AUTH_FACEBOOK_CSEC             |                         | Facebook OAuth client secret                             |\n | auth.microsoft.cid             | AUTH_MICROSOFT_CID             |                         | Microsoft OAuth client ID                                |\n | auth.microsoft.csec            | AUTH_MICROSOFT_CSEC            |                         | Microsoft OAuth client secret                            |\n+| auth.microsoft.tenant          | AUTH_MICROSOFT_TENANT          | `common`                | Azure AD tenant ID, domain, or \"common\"                  |\n | auth.github.cid                | AUTH_GITHUB_CID                |                         | GitHub OAuth client ID                                   |\n | auth.github.csec               | AUTH_GITHUB_CSEC               |                         | GitHub OAuth client secret                               |\n | auth.patreon.cid               | AUTH_PATREON_CID               |                         | Patreon OAuth Client ID                                  |"
    }
  ]
}
