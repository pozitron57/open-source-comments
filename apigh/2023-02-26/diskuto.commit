{
  "sha": "5a725405c8ce7fb7dd10bc0c9203a2a3382cc18b",
  "node_id": "C_kwDOBQ8bstoAKDVhNzI1NDA1YzhjZTdmYjdkZDEwYmMwYzkyMDNhMmEzMzgyY2MxOGI",
  "commit": {
    "author": {
      "name": "Sönke Ludwig",
      "email": "sludwig@outerproduct.org",
      "date": "2023-03-10T08:49:05Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2023-03-10T08:49:05Z"
    },
    "message": "Merge pull request #16 from rejectedsoftware/comment_index\n\nAdd a comment database index",
    "tree": {
      "sha": "8b40e94d952e86d16fc18c382b3ba376864016c7",
      "url": "https://api.github.com/repos/rejectedsoftware/diskuto/git/trees/8b40e94d952e86d16fc18c382b3ba376864016c7"
    },
    "url": "https://api.github.com/repos/rejectedsoftware/diskuto/git/commits/5a725405c8ce7fb7dd10bc0c9203a2a3382cc18b",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkCu8BCRBK7hj4Ov3rIwAA1GsIAGMbvCuHVRIy+MwIYgm0ZEru\n4fLLcS5uaEdXq2iSWLFboFNx2/z7ZQO7RxCYvrRJQbeQbKP65TYkuNHweeBnWeiN\nZP9Lq4IRX6yEotgPNol88bCUEm1Pt90iIi3/2u2FlF+UmqPSx9WbrY9ewzWVCZNz\nmExIBwrvTPtriru53+uSonNT5D26ECyz4aloVLU/Ov3/znK1rL2dGUK9ZTFxuYVO\n8J33maIhCSC3Lr2Dk9j3pnKNKfPaYje4MYiIUBFN6lcuBfE9l0/uoK8hiVP3ecQy\njGJmmQsS7Ko64rpabob56VbWeBGR/YixJ34S2+AkVy0GWwIypcUgjRJxvGAH+2E=\n=d1Xb\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 8b40e94d952e86d16fc18c382b3ba376864016c7\nparent 642b88f6c0fa9e692a870a1451ad6549eda861ea\nparent ee12c25a103b5173c13dab0c92d83488d7b61aee\nauthor Sönke Ludwig <sludwig@outerproduct.org> 1678438145 +0100\ncommitter GitHub <noreply@github.com> 1678438145 +0100\n\nMerge pull request #16 from rejectedsoftware/comment_index\n\nAdd a comment database index"
    }
  },
  "url": "https://api.github.com/repos/rejectedsoftware/diskuto/commits/5a725405c8ce7fb7dd10bc0c9203a2a3382cc18b",
  "html_url": "https://github.com/rejectedsoftware/diskuto/commit/5a725405c8ce7fb7dd10bc0c9203a2a3382cc18b",
  "comments_url": "https://api.github.com/repos/rejectedsoftware/diskuto/commits/5a725405c8ce7fb7dd10bc0c9203a2a3382cc18b/comments",
  "author": {
    "login": "s-ludwig",
    "id": 1645969,
    "node_id": "MDQ6VXNlcjE2NDU5Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1645969?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/s-ludwig",
    "html_url": "https://github.com/s-ludwig",
    "followers_url": "https://api.github.com/users/s-ludwig/followers",
    "following_url": "https://api.github.com/users/s-ludwig/following{/other_user}",
    "gists_url": "https://api.github.com/users/s-ludwig/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/s-ludwig/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/s-ludwig/subscriptions",
    "organizations_url": "https://api.github.com/users/s-ludwig/orgs",
    "repos_url": "https://api.github.com/users/s-ludwig/repos",
    "events_url": "https://api.github.com/users/s-ludwig/events{/privacy}",
    "received_events_url": "https://api.github.com/users/s-ludwig/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "642b88f6c0fa9e692a870a1451ad6549eda861ea",
      "url": "https://api.github.com/repos/rejectedsoftware/diskuto/commits/642b88f6c0fa9e692a870a1451ad6549eda861ea",
      "html_url": "https://github.com/rejectedsoftware/diskuto/commit/642b88f6c0fa9e692a870a1451ad6549eda861ea"
    },
    {
      "sha": "ee12c25a103b5173c13dab0c92d83488d7b61aee",
      "url": "https://api.github.com/repos/rejectedsoftware/diskuto/commits/ee12c25a103b5173c13dab0c92d83488d7b61aee",
      "html_url": "https://github.com/rejectedsoftware/diskuto/commit/ee12c25a103b5173c13dab0c92d83488d7b61aee"
    }
  ],
  "stats": {
    "total": 33,
    "additions": 32,
    "deletions": 1
  },
  "files": [
    {
      "sha": "ca8dd25e2d1c14eabb26c0395ab864cc2583db76",
      "filename": ".github/workflows/ci.yml",
      "status": "added",
      "additions": 27,
      "deletions": 0,
      "changes": 27,
      "blob_url": "https://github.com/rejectedsoftware/diskuto/blob/5a725405c8ce7fb7dd10bc0c9203a2a3382cc18b/.github%2Fworkflows%2Fci.yml",
      "raw_url": "https://github.com/rejectedsoftware/diskuto/raw/5a725405c8ce7fb7dd10bc0c9203a2a3382cc18b/.github%2Fworkflows%2Fci.yml",
      "contents_url": "https://api.github.com/repos/rejectedsoftware/diskuto/contents/.github%2Fworkflows%2Fci.yml?ref=5a725405c8ce7fb7dd10bc0c9203a2a3382cc18b",
      "patch": "@@ -0,0 +1,27 @@\n+name: CI\n+on: [push, pull_request]\n+jobs:\n+  test:\n+    name: CI\n+    runs-on: ubuntu-latest\n+    strategy:\n+      matrix:\n+        dc: [dmd-latest, ldc-latest]\n+    steps:\n+      - uses: actions/checkout@v2\n+      - name: Install D Compiler\n+        uses: dlang-community/setup-dlang@v1\n+        with:\n+          compiler: ${{ matrix.dc }}\n+\n+      - uses: actions/cache@v2\n+        with:\n+          path: ~/.dub\n+          key: ${{ matrix.dc }}-dub-${{ hashFiles('**/dub.selections.json') }}\n+          restore-keys: |\n+            ${{ matrix.dc }}-dub-\n+\n+      - name: Run Tests\n+        run: |\n+          dub build\n+          dub test"
    },
    {
      "sha": "8f9d95d114628f2355d1eada6a77134fc9a1aed6",
      "filename": "source/diskuto/commentstores/mongodb.d",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/rejectedsoftware/diskuto/blob/5a725405c8ce7fb7dd10bc0c9203a2a3382cc18b/source%2Fdiskuto%2Fcommentstores%2Fmongodb.d",
      "raw_url": "https://github.com/rejectedsoftware/diskuto/raw/5a725405c8ce7fb7dd10bc0c9203a2a3382cc18b/source%2Fdiskuto%2Fcommentstores%2Fmongodb.d",
      "contents_url": "https://api.github.com/repos/rejectedsoftware/diskuto/contents/source%2Fdiskuto%2Fcommentstores%2Fmongodb.d?ref=5a725405c8ce7fb7dd10bc0c9203a2a3382cc18b",
      "patch": "@@ -31,6 +31,8 @@ class MongoDBCommentStore : DiskutoCommentStore {\n \t\t// upgrade old status field\n \t\tm_comments.update([\"status\": cast(int)StoredComment.Status.active], [\"$set\": [\"status\": \"active\"]], UpdateFlags.multiUpdate);\n \t\tm_comments.update([\"status\": cast(int)StoredComment.Status.disabled], [\"$set\": [\"status\": \"disabled\"]], UpdateFlags.multiUpdate);\n+\n+\t\tm_comments.createIndex([\"topic\": 1, \"status\": 1]);\n \t}\n \n \tStoredComment.ID postComment(StoredComment comment)\n@@ -43,7 +45,9 @@ class MongoDBCommentStore : DiskutoCommentStore {\n \n \tStoredComment getComment(StoredComment.ID comment)\n \t{\n-\t\treturn cast(StoredComment)m_comments.findOne!(MongoStruct!StoredComment)([\"_id\": BsonObjectID.fromString(comment)]);\n+\t\tauto ret = m_comments.findOne!(MongoStruct!StoredComment)([\"_id\": BsonObjectID.fromString(comment)]);\n+\t\tif (ret.isNull) throw new Exception(\"Unknown commend ID: \" ~ comment);\n+\t\treturn cast(StoredComment)ret.get;\n \t}\n \n \tvoid setCommentStatus(StoredComment.ID id, StoredComment.Status status)"
    }
  ]
}
